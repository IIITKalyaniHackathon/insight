function MarkerSelector(t,a,e,r){return"circle"===a.type?new CityDashboard.CircleMarker(t,a,e,r):"image"===a.type?new CityDashboard.ImageMarker(t,a,e,r):"polyline"===a.type?new CityDashboard.PolylineMarker(t,a,e,r):"simple"===a.type?new CityDashboard.SimpleMarker(t,a,e,r):void 0}function isPointInPoly(t,a){for(var e=!1,r=-1,i=t.length,o=i-1;++r<i;o=r)(t[r].y<=a.y&&a.y<t[o].y||t[o].y<=a.y&&a.y<t[r].y)&&a.x<(t[o].x-t[r].x)*(a.y-t[r].y)/(t[o].y-t[r].y)+t[r].x&&(e=!e);return e}function GridSelector(t,a,e,r){return"square"===a.type?new CityDashboard.SquareGrid(t,a,e,r):"hexagonal"===a.type?new CityDashboard.HexagonalGrid(t,a,e,r):void 0}function HeatmapSelector(t,a,e,r){return"point-heatmap"===a.type?new CityDashboard.PointHeatmap(t,a,e,r):"segment-heatmap"===a.type?new CityDashboard.SegmentHeatmap(t,a,e,r):void 0}function DTesselationSelector(t,a,e,r){return"delaunay"===a.type?new CityDashboard.Delaunay(t,a,e,r):"voronoi"===a.type?new CityDashboard.Voronoi(t,a,e,r):void 0}function LayerSelector(t,a){return"grid-layer"===t.layer?new CityDashboard.GridLayer(t,a):"marker-layer"===t.layer?new CityDashboard.MarkerLayer(t,a):"heatmap-layer"===t.layer?new CityDashboard.HeatmapLayer(t,a):"delaunay-layer"===t.layer?new CityDashboard.DelaunayLayer(t,a):void 0}!function(t){t.fn.resizable=function(a){function e(a){s=a.clientX,n=a.clientY,l=u.outerWidth(),h=u.outerHeight(),t(document).on("mousemove",r),t(document).on("mouseup",i)}function r(t){d&&u.css("height",h+t.clientY-n+"px"),p&&u.css("width",l+t.clientX-s+"px"),c&&u.css("top",t.clientY+"px").css("height",h+n-t.clientY+"px"),y&&u.css("left",t.clientX+"px").css("width",l-t.clientX+"px")}function i(){t(document).off("mousemove",r),t(document).off("mouseup",i),u.trigger("resize")}var o=t("<div>").addClass("resizer").addClass(a+"-resize");this.append(o).addClass("resizable"),o.on("mousedown",e);var s,n,l,h,p,d,c,y,u=this;return d=a.search("s")>=0,p=a.search("e")>=0,c=a.search("n")>=0,y=a.search("w")>=0,this.scroll(function(){o.css("top",u.scrollTop())}),this},t.fn.setID=function(t){return"#"===t.charAt(0)&&(t=t.slice(1)),this.attr("id",t),this},t.fn.movable=function(){var a=this.children(".options-panel");a.length||(a=t("<span>").addClass("options-panel"),this.prepend(a));var e=t("<span>").addClass("up-button").append("&#x25B2;"),r=t("<span>").addClass("down-button").append("&#x25BC;");a.prepend(r),a.prepend(e);var i=this;return e.on("click",function(){i.insertBefore(i.prev())}),r.on("click",function(){i.insertAfter(i.next())}),this},t.fn.closable=function(a){a||(a=function(){});var e=this.children(".options-panel");e.length||(e=t("<span>").addClass("options-panel"),this.prepend(e));var r=t("<span>").addClass("close-button").text("X");e.append(r);var i=this;return r.on("click",function(){i.remove(),a()}),this}}(jQuery);var CityDashboard=function(t){"use strict";var a={main:"#city-dashboard",map:"#mapWindow",info:"#infoWindow",filters:"#filterBar"},e={main:"mainContainerID",map:"mapWindowID",info:"infoWindowID",filters:"filterBarID"},r={mainContainerID:a.main,mapWindowID:a.map,infoWindowID:a.info,filterBarID:a.filters,getData:function(a,e,r){return"#"===a.charAt(0)?e(r):void t.getJSON(a,function(t){return r.data=t,e(r)})},id:function(t,i){if(!(t in a))throw new Error("The container "+t+" does not exist");return i="undefined"==typeof i?a[t]:i,r[e[t]]=a[t]=i,i},container:function(a){return t(r.id(a))}};return r}(jQuery);CityDashboard.GoogleMap=function(t){this.center={lat:t.lat||0,lng:t.lng||0},this.zoom=t.zoom||12;var a=$(CityDashboard.mapWindowID)[0];this.googlemap=new google.maps.Map(a,{zoom:this.zoom,center:new google.maps.LatLng(this.center.lat,this.center.lng),disableDefaultUI:!0}),$(CityDashboard.mainContainerID)[0].data=this.googlemap},CityDashboard.GoogleMap.prototype={constructor:CityDashboard.Map},CityDashboard.Marker=function(t,a,e,r){this.layer_params=t,this.attr=a,this.map=e,this.marker=void 0,this.layer=r},CityDashboard.Marker.prototype={constructor:CityDashboard.Marker,addEvents:function(){function t(){$("#infoWindow").trigger("marker-pressed",{id:a.layer.id,value:a.layer_params,attr:a.attr});for(var t=0;t<a.layer.markers.length;t++){var e=a.layer.markers[t].marker;e.setAnimation(e==this?google.maps.Animation.BOUNCE:null)}}google.maps.event.addListener(this.marker,"click",t);var a=this},triggerInitialEvent:function(){}},CityDashboard.CircleMarker=function(t,a,e,r){CityDashboard.Marker.call(this,t,a,e,r);var i=new google.maps.LatLng(parseFloat(t.lat),parseFloat(t.lng)),o=new google.maps.Circle({center:i,map:e,radius:a.radius||400,strokeColor:a.strokeColor||"#FF0000",strokeOpacity:a.strokeOpacity||.8,strokeWeight:a.strokeWeight||2,fillColor:a.fillColor||"#FF0000",fillOpacity:a.fillOpacity||.35,title:t.landmark||""});this.marker=o},CityDashboard.CircleMarker.prototype=Object.create(CityDashboard.Marker.prototype),CityDashboard.CircleMarker.prototype={constructor:CityDashboard.CircleMarker,addEvents:function(){function t(){$("#infoWindow").trigger("marker-pressed",{id:a.layer.id,value:a.layer_params,attr:a.attr})}google.maps.event.addListener(this.marker,"click",t);var a=this},triggerInitialEvent:function(){$("#infoWindow").trigger("marker-pressed",{id:this.layer.id,value:this.layer_params,attr:this.attr})}},CityDashboard.ImageMarker=function(t,a,e,r){CityDashboard.Marker.call(this,t,a,e,r);var i=new google.maps.LatLng(parseFloat(t.lat),parseFloat(t.lng)),o={url:a.src||"../src/Layers/Markers/not_found.svg",scaledSize:new google.maps.Size(30,50)},s=new google.maps.Marker({position:i,map:e,icon:o,title:t.landmark||""});this.marker=s},CityDashboard.ImageMarker.prototype=Object.create(CityDashboard.Marker.prototype),CityDashboard.ImageMarker.prototype={constructor:CityDashboard.ImageMarker,addEvents:function(){function t(){$("#infoWindow").trigger("marker-pressed",{id:a.layer.id,value:a.layer_params,attr:a.attr});for(var t=0;t<a.layer.markers.length;t++){var e=a.layer.markers[t].marker;e.setAnimation(e==this?google.maps.Animation.BOUNCE:null)}}google.maps.event.addListener(this.marker,"click",t);var a=this},triggerInitialEvent:function(){for($("#infoWindow").trigger("marker-pressed",{id:this.layer.id,value:this.layer_params,attr:this.attr}),i=0;i<this.layer.markers.length;i++)this.layer.markers[i].marker.setAnimation(null);this.marker.setAnimation(google.maps.Animation.BOUNCE)}},CityDashboard.SimpleMarker=function(t,a,e,r){CityDashboard.Marker.call(this,t,a,e,r);var i=new google.maps.LatLng(parseFloat(t.lat),parseFloat(t.lng)),o=new google.maps.Marker({position:i,map:e,title:t.landmark||""});this.marker=o},CityDashboard.SimpleMarker.prototype=Object.create(CityDashboard.Marker.prototype),CityDashboard.SimpleMarker.prototype={constructor:CityDashboard.SimpleMarker,addEvents:function(){function t(){$("#infoWindow").trigger("marker-pressed",{id:a.layer.id,value:a.layer_params,attr:a.attr});for(var t=0;t<a.layer.markers.length;t++){var e=a.layer.markers[t].marker;e.setAnimation(e==this?google.maps.Animation.BOUNCE:null)}}google.maps.event.addListener(this.marker,"click",t);var a=this},triggerInitialEvent:function(){for($("#infoWindow").trigger("marker-pressed",{id:this.layer.id,value:this.layer_params,attr:this.attr}),i=0;i<this.layer.markers.length;i++)this.layer.markers[i].marker.setAnimation(null);this.marker.setAnimation(google.maps.Animation.BOUNCE)}},CityDashboard.PolylineMarker=function(t,a,e,r){CityDashboard.Marker.call(this,t,a,e,r);for(var i=[],o=t.points.length,s=0;o>s;s++)i[s]=new google.maps.LatLng(parseFloat(t.points[s].lat),parseFloat(t.points[s].lng));var n=new google.maps.Polyline({path:i,strokeColor:a.strokeColor||"#000000",strokeOpacity:a.strokeOpacity||1,strokeWeight:a.strokeWeight||2});n.setMap(e)},CityDashboard.PolylineMarker.prototype=Object.create(CityDashboard.Marker.prototype),CityDashboard.PolylineMarker.prototype={constructor:CityDashboard.PolylineMarker,addEvents:function(){},triggerInitialEvent:function(){}},CityDashboard.Grid=function(t,a,e,r){this.layer_params=t,this.attr=a,this.map=e,this.layer=r,this.tiles=[]},CityDashboard.Grid.prototype={constructor:CityDashboard.Grid,build:function(){},addEvents:function(){}},CityDashboard.HexagonalGrid=function(t,a,e,r){CityDashboard.Grid.call(this,t,a,e,r)},CityDashboard.HexagonalGrid.prototype=Object.create(CityDashboard.Grid.prototype),CityDashboard.HexagonalGrid.prototype={constructor:CityDashboard.HexagonalGrid,build:function(t){var a,e,r;l=this.attr.size||.02;var i=this.tiles.length;for(a=0;i>a;a++)this.tiles[a].setMap(null);this.tiles=[];var o=this.map.getZoom(),s=l*Math.pow(2,12),n=[];for(a=0;22>a;a++)n.push(s),s/=2;var h=["transparent","blue","cyan","green","yellow","red"],p=n[o],d=t.getNorthEast(),c=t.getSouthWest(),y=Math.ceil(.75*Math.abs(c.lat()-d.lat())/p),u=Math.ceil(5/8*Math.abs(c.lng()-d.lng())/p),g=p*Math.sin(Math.PI/6),f=p*Math.cos(Math.PI/6);for(a=0;y>a;a++)for(e=0;u>e;e++){var m,v=d.lat()-(p+g)*a;m=a%2===0?d.lng()-2*f*e+f:d.lng()-2*f*e,poly=[{x:v,y:m},{x:v-p,y:m},{x:v-p-g,y:m-f},{x:v-p,y:m-2*f},{x:v,y:m-2*f},{x:v+g,y:m-f},{x:v,y:m}];var b=[new google.maps.LatLng(poly[0].x,poly[0].y),new google.maps.LatLng(poly[1].x,poly[1].y),new google.maps.LatLng(poly[2].x,poly[2].y),new google.maps.LatLng(poly[3].x,poly[3].y),new google.maps.LatLng(poly[4].x,poly[4].y),new google.maps.LatLng(poly[5].x,poly[5].y),new google.maps.LatLng(poly[6].x,poly[6].y)];for(pointsInScreen=[],weightsInScreen=[],r=0;r<this.layer_params.points.length;r++)t.contains(new google.maps.LatLng(this.layer_params.points[r].lat,this.layer_params.points[r].lng))&&(pointsInScreen.push(this.layer_params.points[r]),weightsInScreen.push(this.layer_params.weights[r]));var C=0,D=(1/weightsInScreen.length,0);for(r=0;r<weightsInScreen.length;r++)D+=weightsInScreen[r];for(r=0;r<weightsInScreen.length;r++)weightsInScreen[r]=weightsInScreen[r]/D;for(r=0;r<pointsInScreen.length;r++)isPointInPoly(poly,{x:pointsInScreen[r].lat,y:pointsInScreen[r].lng})&&(C+=weightsInScreen[r]);var k=new google.maps.Polygon({paths:b,strokeColor:this.attr.color||"#000000",strokeOpacity:.5,strokeWeight:2,fillColor:h[Math.floor(C*h.length+.5)]||"#000000",fillOpacity:.2,geodesic:!0});k.setMap(this.map),this.tiles.push(k)}},addEvents:function(){var t=this;google.maps.event.addListener(this.map,"bounds_changed",function(){window.setTimeout(t.build(this.getBounds()),50)})}},CityDashboard.SquareGrid=function(t,a,e,r){CityDashboard.Grid.call(this,t,a,e,r)},CityDashboard.SquareGrid.prototype=Object.create(CityDashboard.Grid.prototype),CityDashboard.SquareGrid.prototype={constructor:CityDashboard.SquareGrid,build:function(t){var a,e,r=this.attr.size||.03,i=this.tiles.length;for(a=0;i>a;a++)this.tiles[a].setMap(null);this.tiles=[];var o=this.map.getZoom(),s=r*Math.pow(2,12),n=[];for(a=0;22>a;a++)n.push(s),s/=2;var l=n[o],h=t.getNorthEast()||0,p=t.getSouthWest()||0,d=Math.ceil(Math.abs(p.lat()-h.lat())/l),c=Math.ceil(Math.abs(p.lng()-h.lng())/l);for(a=0;d>a;a++)for(e=0;c>e;e++){var y=h.lat()-l*a,u=h.lng()-l*e,g=[new google.maps.LatLng(y,u),new google.maps.LatLng(y-l,u),new google.maps.LatLng(y-l,u-l),new google.maps.LatLng(y,u-l),new google.maps.LatLng(y,u)],f=new google.maps.Polygon({paths:g,strokeColor:this.attr.color||"#578b8b",strokeOpacity:.5,strokeWeight:2,fillColor:this.attr.color||"#578b8b",fillOpacity:0,geodesic:!0});f.setMap(this.map),this.tiles.push(f)}},addEvents:function(){var t=this;google.maps.event.addListener(this.map,"bounds_changed",function(){window.setTimeout(t.build(this.getBounds()),50)})}},CityDashboard.Heatmap=function(){},CityDashboard.Heatmap.prototype={constructor:CityDashboard.Heatmap},CityDashboard.PointHeatmap=function(t,a,e){var r,i=[],o=t.points.length;if(t.weights&&t.weights.length>=o)for(r=0;o>r;r++)i[r]={location:new google.maps.LatLng(parseFloat(t.points[r].lat),parseFloat(t.points[r].lng)),weight:t.weights[r]};else for(r=0;o>r;r++)i[r]=new google.maps.LatLng(parseFloat(t.points[r].lat),parseFloat(t.points[r].lng));var s=new google.maps.MVCArray(i);this.heatmap=new google.maps.visualization.HeatmapLayer({data:s,radius:a.radius||10}),this.heatmap.setMap(e)},CityDashboard.PointHeatmap.prototype=Object.create(CityDashboard.Heatmap.prototype),CityDashboard.PointHeatmap.prototype={constructor:CityDashboard.PointHeatmap},CityDashboard.SegmentHeatmap=function(t,a,e){var r,i,o=[],s=t.segments.length;for(r=0;s>r;r++)for(o[r]=[],i=0;i<t.segments[r].length;i++)o[r][i]={lat:parseFloat(t.segments[r][i].lat),lng:parseFloat(t.segments[r][i].lng)};var n=[];for(r=0;r<o.length;r++){var l=o[r].length;for(i=0;l-1>i;i++)for(var h=Math.sqrt(Math.pow(o[r][i+1].lat-o[r][i].lat,2)+Math.pow(o[r][i+1].lng-o[r][i].lng,2)),p=Math.floor(h/1e-5),d={lat:(o[r][i+1].lat-o[r][i].lat)/p,lng:(o[r][i+1].lng-o[r][i].lng)/p},c=0;p>c;c++){var y=o[r][i].lat,u=o[r][i].lng;n.push({location:new google.maps.LatLng(y+d.lat*c,u+d.lng*c),weight:t.weights[r]||1})}}this.heatmap=new google.maps.visualization.HeatmapLayer({data:n}),this.heatmap.setMap(e)},CityDashboard.SegmentHeatmap.prototype=Object.create(CityDashboard.Heatmap.prototype),CityDashboard.SegmentHeatmap.prototype={constructor:CityDashboard.SegmentHeatmap},CityDashboard.DTesselation=function(t,a,e,r){this.layer_params=t,this.attr=a,this.map=e,this.layer=r},CityDashboard.DTesselation.prototype={constructor:CityDashboard.DTesselation,build:function(){},addEvents:function(){},Add_GMapLine:function(t,a,e,r,i,o,s){var n=180/Math.PI;if(!(e.length<2)){for(var l=a[e[0]],h=[l],p=1;p<e.length;p++){var d=a[e[p]];h=h.concat(this.SplitSegment(l,d),[d]),l=d}for(var c=[],y=0;y<h.length;y++){var d=h[y],u=n*Math.atan2(d[2],Math.sqrt(d[0]*d[0]+d[1]*d[1])),g=n*Math.atan2(d[1],d[0]);c.push(new google.maps.LatLng(u,g))}var f=new google.maps.Polyline({path:c,strokeColor:r,strokeWeight:i,strokeOpacity:o,clickable:!1});f.setMap(s),t.push(f)}},SplitSegment:function(t,a){for(var e=0,r=0;3>r;r++){var i=a[r]-t[r];e+=i*i}var o=[];if(.01>e)return o;for(var s=new Array(3),r=0;3>r;r++)s[r]=t[r]+a[r];for(var n=0,r=0;3>r;r++)pc=s[r],n+=pc*pc;for(var l=1/Math.sqrt(n),r=0;3>r;r++)s[r]*=l;return o.concat(this.SplitSegment(t,s),[s],this.SplitSegment(s,a))},ClearOvlyArray:function(t){for(;t.length>0;){var a=t.pop();a.setMap(null)}}},CityDashboard.Voronoi=function(t,a,e,r){CityDashboard.DTesselation.call(this,t,a,e,r);for(var i=[],o=Math.PI/180,s=(180/Math.PI,[]),n=t.points.length,l=0;n>l;l++)i[l]=new google.maps.LatLng(parseFloat(t.points[l].lat),parseFloat(t.points[l].lng));var h=this,p=function(){h.ClearOvlyArray(s);for(var t=[],r=0;r<i.length;r++){for(var n=i[r],l=o*n.lat(),p=o*n.lng(),d=Math.cos(l),c=[d*Math.cos(p),d*Math.sin(p),Math.sin(l)],y=0;3>y;y++)c[y]+=1e-10*(2*Math.random()-1);for(var u=0,y=0;3>y;y++)u+=c[y]*c[y];for(var g=1/Math.sqrt(u),y=0;3>y;y++)c[y]*=g;t.push(c)}for(var f=FindDelaunayTriangulation(t),r=0;r<f.vor_edges.length;r++){var m=f.vor_edges[r];m[0]<0||m[1]<0||h.Add_GMapLine(s,f.vor_positions,m,a.color||"#578b8b",2,1,e)}};p(),markers=[];for(var l=0;l<i.length;l++){var d=new google.maps.Marker({position:i[l],map:e,draggable:!0});markers[l]=d}for(var c=function(){for(var t=0;t<i.length;t++)if(markers[t].position!=i[t]){i[t]=this.position;break}p()},l=0;l<i.length;l++)google.maps.event.addListener(markers[l],"drag",c)},CityDashboard.Voronoi.prototype=Object.create(CityDashboard.DTesselation.prototype),CityDashboard.Voronoi.prototype={constructor:CityDashboard.Voronoi,build:function(){},addEvents:function(){},Add_GMapLine:function(t,a,e,r,i,o,s){var n=180/Math.PI;if(!(e.length<2)){for(var l=a[e[0]],h=[l],p=1;p<e.length;p++){var d=a[e[p]];h=h.concat(this.SplitSegment(l,d),[d]),l=d}for(var c=[],y=0;y<h.length;y++){var d=h[y],u=n*Math.atan2(d[2],Math.sqrt(d[0]*d[0]+d[1]*d[1])),g=n*Math.atan2(d[1],d[0]);c.push(new google.maps.LatLng(u,g))}var f=new google.maps.Polyline({path:c,strokeColor:r,strokeWeight:i,strokeOpacity:o,clickable:!1});f.setMap(s),t.push(f)}},SplitSegment:function(t,a){for(var e=0,r=0;3>r;r++){var i=a[r]-t[r];e+=i*i}var o=[];if(.01>e)return o;for(var s=new Array(3),r=0;3>r;r++)s[r]=t[r]+a[r];for(var n=0,r=0;3>r;r++)pc=s[r],n+=pc*pc;for(var l=1/Math.sqrt(n),r=0;3>r;r++)s[r]*=l;return o.concat(this.SplitSegment(t,s),[s],this.SplitSegment(s,a))},ClearOvlyArray:function(t){for(;t.length>0;){var a=t.pop();a.setMap(null)}}},CityDashboard.Delaunay=function(t,a,e,r){CityDashboard.DTesselation.call(this,t,a,e,r);for(var i=[],o=Math.PI/180,s=(180/Math.PI,[]),n=t.points.length,l=0;n>l;l++)i[l]=new google.maps.LatLng(parseFloat(t.points[l].lat),parseFloat(t.points[l].lng));var h=this,p=function(){h.ClearOvlyArray(s);for(var t=[],r=0;r<i.length;r++){for(var n=i[r],l=o*n.lat(),p=o*n.lng(),d=Math.cos(l),c=[d*Math.cos(p),d*Math.sin(p),Math.sin(l)],y=0;3>y;y++)c[y]+=1e-10*(2*Math.random()-1);for(var u=0,y=0;3>y;y++)u+=c[y]*c[y];for(var g=1/Math.sqrt(u),y=0;3>y;y++)c[y]*=g;t.push(c)}for(var f=FindDelaunayTriangulation(t),r=0;r<f.edges.length;r++){var m=f.edges[r];h.Add_GMapLine(s,f.positions,m.verts,a.color||"#578b8b",2,1,e)}};p(),markers=[];for(var l=0;l<i.length;l++){var d=new google.maps.Marker({position:i[l],map:e,draggable:!0});markers[l]=d}for(var c=function(){for(var t=0;t<i.length;t++)if(markers[t].position!=i[t]){i[t]=this.position;break}p()},l=0;l<i.length;l++)google.maps.event.addListener(markers[l],"drag",c)},CityDashboard.Delaunay.prototype=Object.create(CityDashboard.DTesselation.prototype),CityDashboard.Delaunay.prototype={constructor:CityDashboard.Delaunay,build:function(){},addEvents:function(){},Add_GMapLine:function(t,a,e,r,i,o,s){var n=180/Math.PI;if(!(e.length<2)){for(var l=a[e[0]],h=[l],p=1;p<e.length;p++){var d=a[e[p]];h=h.concat(this.SplitSegment(l,d),[d]),l=d}for(var c=[],y=0;y<h.length;y++){var d=h[y],u=n*Math.atan2(d[2],Math.sqrt(d[0]*d[0]+d[1]*d[1])),g=n*Math.atan2(d[1],d[0]);c.push(new google.maps.LatLng(u,g))}var f=new google.maps.Polyline({path:c,strokeColor:r,strokeWeight:i,strokeOpacity:o,clickable:!1});f.setMap(s),t.push(f)}},SplitSegment:function(t,a){for(var e=0,r=0;3>r;r++){var i=a[r]-t[r];e+=i*i}var o=[];if(.01>e)return o;for(var s=new Array(3),r=0;3>r;r++)s[r]=t[r]+a[r];for(var n=0,r=0;3>r;r++)pc=s[r],n+=pc*pc;for(var l=1/Math.sqrt(n),r=0;3>r;r++)s[r]*=l;return o.concat(this.SplitSegment(t,s),[s],this.SplitSegment(s,a))},ClearOvlyArray:function(t){for(;t.length>0;){var a=t.pop();a.setMap(null)}}};var CityDashboard=CityDashboard||{};CityDashboard.Layer=function(t){"use strict";var a=function(t,a){if(this.wrappedLayer=void 0,void 0===t.id)throw Error("All layers must have an ID.");this.id=t.id,this.dataSource=t.dataSource,this.elements=t.data.length?t.data:[t.data],this.elementsAttr=t.layer_attr||{type:"simple",action:"update"},this.map=a};return a.prototype={constructor:t.Layer,filter:function(){},clear:function(){}},a}(CityDashboard),CityDashboard.MarkerLayer=function(t,a){CityDashboard.Layer.call(this,t,a),this.markers=[];for(var e=this.elements.length-1;e>=0;e--){var r=MarkerSelector(this.elements[e],this.elementsAttr,this.map,this);this.markers.push(r),r.addEvents()}this.markers[0].triggerInitialEvent()},CityDashboard.MarkerLayer.prototype=Object.create(CityDashboard.Layer.prototype),CityDashboard.MarkerLayer.prototype={constructor:CityDashboard.MarkerLayer,filter:function(t){for(i=0;i<this.markers.length;i++)this.markers[i].marker.setVisible(t(this.markers[i].layer_params)?!0:!1);for(i=0;i<this.markers.length;i++)if(this.markers[i].marker.getVisible()){this.markers[i].triggerInitialEvent();break}},clear:function(){for(var t=0;t<this.markers.length;t++)this.markers[t].marker.setMap(null)}},CityDashboard.GridLayer=function(t,a){CityDashboard.Layer.call(this,t,a),this.grid=GridSelector(this.elements[0],this.elementsAttr,this.map,this),this.grid.addEvents()},CityDashboard.GridLayer.prototype=Object.create(CityDashboard.Layer.prototype),CityDashboard.GridLayer.prototype={constructor:CityDashboard.GridLayer,clear:function(){for(var t=0;t<this.grid.tiles.length;t++)this.grid.tiles[t].setMap(null)}},CityDashboard.HeatmapLayer=function(t,a){CityDashboard.Layer.call(this,t,a),this.heatmap=new HeatmapSelector(this.elements[0],this.elementsAttr,this.map,this)},CityDashboard.HeatmapLayer.prototype=Object.create(CityDashboard.Layer.prototype),CityDashboard.HeatmapLayer.prototype={constructor:CityDashboard.HeatmapLayer,clear:function(){this.heatmap.heatmap.setMap(null)}},CityDashboard.DelaunayLayer=function(t,a){CityDashboard.Layer.call(this,t,a);var e=DTesselationSelector(this.elements[0],this.elementsAttr,this.map,this);e.addEvents()},CityDashboard.DelaunayLayer.prototype=Object.create(CityDashboard.Layer.prototype),CityDashboard.DelaunayLayer.prototype={constructor:CityDashboard.DelaunayLayer,clear:function(){}},CityDashboard.Visualization=function(t){var a;this.id=t.id,this.data_source=t["data-source"]||this.id,this.properties=t.properties||{},this.title=t.title||"",this.dataPreprocess=t.preprocess||function(t){return t},this.setData(t.data||{});var a=$("<h4>").append(this.title).addClass("viz-title"),e=this;this.viz=$("<div>").setID(this.id).addClass("visualization").append(a).append($("<hr>").addClass("viz-bar")),(void 0===this.properties.closable||this.properties.closable)&&this.viz.closable(function(){return e.remove()}),(void 0===this.properties.movable||this.properties.movable)&&this.viz.movable(),this.viz.append($("<h6>").addClass("latlngView")),$(CityDashboard.infoWindowID).append(this.viz),this.viz.css(this.properties),this.checkbox_handler=t["checkbox-handler"]||function(t,a){return a},t.checkbox&&this.addCheckbox(t.checkbox)},CityDashboard.Visualization.prototype={constructor:CityDashboard.Visualization,setData:function(t){t instanceof Array||(t=jQuery.extend({},t)),this.data=t&&0!==Object.keys(t).length?this.dataPreprocess(t):{}},getData:function(){return this.data},refresh:function(){var t=$(this.id).find(".latlngView").empty();this.viz.find(".deflist").remove();var a=this.getData(),e=a.lat,r=a.lng;e&&r&&t.text("lat: "+e+", lng: "+r).insertAfter($(this.id).find("hr"))},remove:function(){$(CityDashboard.infoWindowID).trigger("remove-viz",{id:this.id,"data-source":this.data_source})},createDefList:function(t){var a=this.id;$.each(t,function(t,e){"lat"!==t&&"lng"!==t&&"value"!==t&&$(a).find(".deflist").append($("<dt>").text(t).addClass("deflist-key")).append($("<dd>").text(e).addClass("deflist-value"))})},addCheckbox:function(t){var a=$("<span>").addClass("checkbox-panel"),e=[];for(var r in t){var i=$("<input>").attr("type","checkbox");e[e.length]=i[0].checked=t[r],a.append(i);var o=this;i.on("change",function(){var t=$(this).parent().children("input:checkbox").map(function(){return $(this).prop("checked")}).get();o.getData=function(){var a=o.data;return o.data instanceof Array||(a=jQuery.extend({},o.data)),o.checkbox_handler(t,a)},o.refresh()}),i.after($("<label>").text(r))}this.viz.append(a),o.getData=function(){var t=o.data;return o.data instanceof Array||(t=jQuery.extend({},o.data)),o.checkbox_handler(e,t)}}},CityDashboard.SummaryVisualization=function(t){CityDashboard.Visualization.call(this,t),this.viz.addClass("summary-viz"),this.refresh()},CityDashboard.SummaryVisualization.prototype=Object.create(CityDashboard.Visualization.prototype),CityDashboard.SummaryVisualization.prototype.refresh=function(){CityDashboard.Visualization.prototype.refresh.call(this),this.viz.append($("<dl>").addClass("deflist")),this.createDefList(this.data)},CityDashboard.GeneralVisualization=function(t){CityDashboard.Visualization.call(this,t),this.viz.addClass("general-viz"),this.dom=t.dom,this.refresh()},CityDashboard.GeneralVisualization.prototype=Object.create(CityDashboard.Visualization.prototype),CityDashboard.GeneralVisualization.prototype.refresh=function(){CityDashboard.Visualization.prototype.refresh.call(this),this.viz.append(this.dom)},CityDashboard.GeneralVisualization.prototype.remove=function(){CityDashboard.Visualization.prototype.remove.call(this)},CityDashboard.ChartistVisualization=function(t,a){CityDashboard.Visualization.call(this,t),this.chartConstructor=a,this.viz.addClass("chartist-viz").append($("<div>").addClass(this.properties["class"])),this.options=t.options||{},this.responsiveOptions=t.responsiveOptions||{},this.labels=t.labels,this.refresh()},CityDashboard.ChartistVisualization.prototype=Object.create(CityDashboard.Visualization.prototype),CityDashboard.ChartistVisualization.prototype.refresh=function(){CityDashboard.Visualization.prototype.refresh.call(this);var t=this.getData();t=t.value||t;var a={series:t,labels:"function"==typeof this.labels?this.labels(t):this.labels};this.chart&&this.chart.optionsProvider?this.chart.update(a):this.chart=new this.chartConstructor(this.id+" > div",a,this.options,this.responsiveOptions),this.viz.append($("<dl>").addClass("deflist")),this.data instanceof Array||this.createDefList(this.data)},CityDashboard.ChartistVisualization.prototype.remove=function(){CityDashboard.Visualization.prototype.remove.call(this),this.chart.detach()},CityDashboard.D3Visualization=function(t){CityDashboard.Visualization.call(this,t);var a=$("<div>");this.viz.addClass("d3-viz").append(a);var e=.61803398875,r=a.width(),i=e*r;this.svg=d3.select(this.id+" div").append("svg"),this._create=t["golden-ratio"]?function(){return arguments[1]=arguments[1].value||arguments[1],arguments[3]=a.width()*e,t.viz.apply(t,arguments)}:function(){return arguments[3]=i,arguments[1]=arguments[1].value||arguments[1],t.viz.apply(t,arguments)},CityDashboard.Visualization.prototype.refresh.call(this),this._create(this.svg,this.getData(),r,i)},CityDashboard.D3Visualization.prototype=Object.create(CityDashboard.Visualization.prototype),CityDashboard.D3Visualization.prototype.refresh=function(){CityDashboard.Visualization.prototype.refresh.call(this),this.svg.selectAll("*").remove();var t=this.getData(),a=$(this.id);this._create(this.svg,t,a.width(),a.height()),this.viz.append($("<dl>").addClass("deflist")),t instanceof Array||this.createDefList(t)},CityDashboard.D3Visualization.prototype.remove=function(){CityDashboard.Visualization.prototype.remove.call(this),this.svg.remove()};var CityDashboard=CityDashboard||{};CityDashboard.FilterBar=function(t,a,e){"use strict";return function(){function r(){for(var t=[],a=0;a<s.length;a++)s[a].element.prop("selectedIndex")>0&&t.push(s[a].options[s[a].element.prop("selectedIndex")-1].filter);return function(a){for(var e=0;e<t.length;e++)if(!t[e](a))return!1;return!0}}function i(){t.container("main").trigger("filterChanged",function(){return r()})}var o=e("<div>").setID(t.id("filters")).addClass("filterBar"),s=[],n=new a.maps.Geocoder,l=o.append(e("<input>").addClass("search").attr("type","search").attr("placeholder","Enter location")),h=function(){var e=t.container("main")[0].data,r=l.val();n.geocode({address:r},function(t,i){i==a.maps.GeocoderStatus.OK?(e.setCenter(t[0].geometry.location),e.fitBounds(t[0].geometry.bounds)):l.val("not found: "+r)})};return l.on("change",h),t.container("main").append(o),{addFilter:function(t){var a=e("<select>"),r=t.description||"",n=e("<option>").text(r);a.append(n);var l;for(l=0;l<t.options.length;l++)n=e("<option>").text(t.options[l].name),a.append(n);return a.on("change",i),o.append(a),t.element=a,s.push(t),a}}}}(CityDashboard,google,jQuery);var CityDashboard=CityDashboard||{};CityDashboard.InfoWindow=function(t,a){"use strict";return function(e){function r(a){var e=a.visualization,r=function(a){var r;if(e)return"summary-viz"===e?r=new t.SummaryVisualization(a):"linechart-viz"===e?r=new t.ChartistVisualization(a,Chartist.Line):"barchart-viz"===e?r=new t.ChartistVisualization(a,Chartist.Bar):"piechart-viz"===e?r=new t.ChartistVisualization(a,Chartist.Pie):"d3-viz"===e?r=new t.D3Visualization(a):"general-viz"===e&&(r=new t.GeneralVisualization(a)),i[r.id]=r,o[r.data_source]=o[r.data_source]||[],o[r.data_source].push(r),r};return t.getData(a["data-source"],r,a)}e=e||[];for(var i={},o={},s=0;s<e.length;s++)r(e[s]);var n=t.container("info"),l=function(t,e){if(n.off("marker-pressed"),e.attr.id&&!(e.attr.id in i)){var s=a.extend({},e.attr);s.data=e.value,s["data-source"]=e.id,r(s)}for(var h=o[e.id]||[],p=h.length-1;p>=0;p--)h[p].setData(e.value),h[p].refresh();n.on("marker-pressed",l)};n.on("marker-pressed",l),n.on("resize",function(){for(var t in i)i[t].refresh()}),n.on("remove-viz",function(t,e){delete i[e.id];var r=a.inArray(o[e["data-source"]],e.id);o[e["data-source"]].splice(r,1)})}}(CityDashboard,jQuery),CityDashboard=CityDashboard||{},CityDashboard.Dashboard=function(t,a){"use strict";var e=function(e){if(this.layers=[],!e.anchor)throw new Error("Anchor ID is required.");this.anchor=e.anchor,this.layout="layout-"+(e.layout||"none");var r,i=a("<div>").setID(t.id("main")).addClass("mainDashboard").addClass(this.layout);if("layout-none"!==this.layout){r=a("<div>").setID(t.id("info")).addClass("infoWindow");var o;"layout-left"===this.layout?o="e":"layout-right"===this.layout&&(o="w"),r.resizable(o),i.append(r)}var s=a("<div>").setID(t.id("map")).addClass("mapWindow");i.append(s),a(this.anchor).append(i),this.filters=new t.FilterBar(e["filter-number"]||0);var n=this.layers;i.on("filterChanged",function(t,a){for(var e=a(),r=n.length-1;r>=0;r--)n[r].filter(e)})};return e.prototype={constructor:t.Dashboard,addLayer:function(a){var e=this.layers,r=function(a){e[e.length]=new LayerSelector(a,t.container("main")[0].data)};return t.getData(a["data-source"],r,a),this},addFilter:function(t){return this.filters.addFilter(t),this},clear:function(){for(var t=0;t<this.layers.length;t++)this.layers[t].clear();this.layers=[]}},e}(CityDashboard,jQuery);