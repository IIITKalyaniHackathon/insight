function dotprd(e,t){for(var n=0,r=0;3>r;r++)n+=e[r]*t[r];return n}function crsprd(e,t){for(var n=new Array(3),r=0;3>r;r++){var i=r+1;i>=3&&(i-=3);var a=r+2;a>=3&&(a-=3),n[r]=e[i]*t[a]-e[a]*t[i]}return n}function triple_prd(e,t,n){return dotprd(crsprd(e,t),n)}function ptdist(e,t){for(var n=0,r=0,i=0;3>i;i++){var a=t[i]-e[i];n+=a*a;var o=t[i]+e[i];r+=o*o}return Math.sqrt(n)-Math.sqrt(r)}function Normalize(e){for(var t=new Array(3),n=0,r=0;3>r;r++){var i=e[r];n+=i*i}for(n>0?nrmult=1/Math.sqrt(n):nrmult=0,r=0;3>r;r++)t[r]=nrmult*e[r];return t}function dotprd_ix(e,t,n){return dotprd(e[t],e[n])}function crsprd_ix(e,t,n){return crsprd(e[t],e[n])}function triple_prd_ix(e,t,n,r){return triple_prd(e[t],e[n],e[r])}function ptdist_ix(e,t,n){return ptdist(e[t],e[n])}function zerovec(){for(var e=new Array(3),t=0;3>t;t++)e[t]=0;return e}function vec_copy(e){for(var t=new Array(3),n=0;3>n;n++)t[n]=e[n];return t}function vec_add_to(e,t){for(var n=0;3>n;n++)e[n]+=t[n]}function vec_mult_scalar_to(e,t){for(var n=0;3>n;n++)e[n]*=t}function vec_difference(e,t){for(var n=zerovec(),r=0;3>r;r++)n[r]=e[r]-t[r];return n}function IsNull(e){return"undefined"==typeof e}function TrianglesEqual(e,t){if(IsNull(e))return!1;if(IsNull(t))return!1;for(var n=0;3>n;n++)if(e.verts[n]!=t.verts[n])return!1;return!0}function EdgesEqual(e,t){if(IsNull(e))return!1;if(IsNull(t))return!1;for(var n=0;2>n;n++)if(e.verts[n]!=t.verts[n])return!1;return!0}function min(e,t){return e>t?t:e}function max(e,t){return t>e?t:e}function TriangleObject(e,t){this.verts=t,this.edges=new Array(3),this.dirs=new Array(3);for(var n=0;3>n;n++){var r=n+1;r>=3&&(r-=3);var i=n+2;i>=3&&(i-=3),this.dirs[n]=crsprd_ix(e,t[r],t[i])}for(this.vol=triple_prd_ix(e,t[0],t[1],t[2]),n=0;3>n;n++)vec_mult_scalar_to(this.dirs[n],1/this.vol);var a=zerovec();for(n=0;3>n;n++)vec_add_to(a,this.dirs[n]);this.ccdir=Normalize(a);var o=0;for(n=0;3>n;n++)o+=ptdist(this.ccdir,e[t[n]]);o/=3,this.ccdsq=o}function EdgeObject(e){this.verts=e,this.polys=new Array(2)}function EdgeCheckObject(e,t){this.verts=t,this.pdst=ptdist_ix(e,t[0],t[1]),this.direc=Normalize(crsprd_ix(e,t[0],t[1]));var n=zerovec();vec_add_to(n,e[t[0]]),vec_add_to(n,e[t[1]]),this.midpnt=Normalize(n)}function AddUnique(e,t){for(var n=0;n<e.length;n++)if(t==e[n])return;e.push(t)}function AddUniqueEdge(e,t){for(var n=0;n<e.length;n++)if(EdgesEqual(e[n],t))return;e.push(t)}function FindShared(e,t){for(var n=[],r=0;r<e.length;r++)for(var i=e[r],a=0;a<t.length;a++){var o=t[a];if(i==o){n.push(i);break}}return n}function FindSharedEdges(e,t){for(var n=[],r=0;r<e.length;r++)for(var i=e[r],a=0;a<t.length;a++){var o=t[a];if(EdgesEqual(i,o)){n.push(i);break}}return n}function FindSetDifference(e,t){if(0!==t.length){for(var n=[],r=0;r<e.length;r++){for(var i=e[r],a=!0,o=0;o<t.length;o++){var s=t[o];if(s==i){a=!1;break}}a&&n.push(i)}e.splice(0,e.length);for(var l=0;l<n.length;l++)e.push(n[l])}}function FindSetDifferenceEdges(e,t){if(0!==t.length){for(var n=[],r=0;r<e.length;r++){for(var i=e[r],a=!0,o=0;o<t.length;o++){var s=t[o];if(EdgesEqual(i,s)){a=!1;break}}a&&n.push(i)}e.splice(0,e.length);for(var l=0;l<n.length;l++)e.push(n[l])}}function TestConsistency(e){for(var t,n,r,i,a,o=!0,s=0;s<e.triangles.length;s++)for(i=e.triangles[s],n=0;3>n;n++){for(t=i.edges[n],a=0,r=0;3>r;r++)t.IsVertex(i.verts[r])&&a++;2!=a&&(o=!1),t.PolyIndexIn(i)<0&&(o=!1)}for(s=0;s<e.edges.length;s++){t=e.edges[s];var l=0;for(n=0;2>n;n++)if(i=t.polys[n],IsNull(i))l++;else{for(a=0,r=0;2>r;r++)i.IsVertex(t.verts[r])&&a++;2!=a&&(o=!1),i.EdgeIndexIn(t)<0&&(o=!1)}l>1&&(o=!1)}return o}function AddPointInside(e,t){for(var n,r=e.positions,i=r[t],a=e.triangles.length,o=0;a>o;o++){var s=e.triangles[o];if(s.IsPointInside(i)){for(var l=s.edges,c=[],d=0;3>d;d++)c.push(l[d].PolyIndexIn(s));var u=Array(3),f=Array(3);for(d=0;3>d;d++)n=d+1,n>=3&&(n-=3),u[d]=new TriangleObject(r,[s.verts[d],s.verts[n],t]),f[d]=new EdgeObject([s.verts[d],t]);for(d=0;3>d;d++)n=d+1,n>=3&&(n-=3),u[d].edges[0]=f[n],u[d].edges[1]=f[d],f[d].polys[0]=u[d],f[n].polys[1]=u[d];for(d=0;3>d;d++)for(var h=l[d],g=c[d],p=0;3>p;p++){var v=u[p];numverts=0;for(var y=0;2>y;y++)if(v.IsVertex(h.verts[y])&&numverts++,2==numverts){h.polys[g]=v,v.edges[2]=h;break}}for(e.triangles[o]=u[0],d=1;3>d;d++)e.triangles.push(u[d]);for(d=0;3>d;d++)e.edges.push(f[d]);return!0}}return!1}function ImproveTriangulation(e){for(var t,n=e.positions,r=new Array(4),i=0;100>i;i++){for(var a=0,o=0;o<e.edges.length;o++){var s=e.edges[o],l=s.polys;if(!IsNull(l[0])&&!IsNull(l[1])){for(u=0;3>u&&(t=l[0].verts[u],s.IsVertex(t));u++);var c=u+1;c>=3&&(c-=3);var d=u+2;d>=3&&(d-=3),r[0]=t,r[1]=l[0].verts[c],r[3]=l[0].verts[d];for(var u=0;3>u&&(t=l[1].verts[u],s.IsVertex(t));u++);r[2]=t;var f=l[0].IsPointInCircumcircle(n[r[2]]),h=l[1].IsPointInCircumcircle(n[r[0]]);if(f||h){var g=new TriangleObject(n,[r[0],r[1],r[2]]);if(g.IsVertexOrderCorrect()){var p=new TriangleObject(n,[r[0],r[2],r[3]]);if(p.IsVertexOrderCorrect()){a++;var v,y,m,b,_;for(u=0;3>u;u++)if(v=l[0].edges[u],!EdgesEqual(v,s)&&v.IsVertex(r[3])){y=v,b=u;break}for(u=0;3>u;u++)if(v=l[1].edges[u],!EdgesEqual(v,s)&&v.IsVertex(r[1])){m=v,_=u;break}var w=y.PolyIndexIn(l[0]),x=m.PolyIndexIn(l[1]);y.polys[w]=l[1],m.polys[x]=l[0],l[0].edges[b]=m,l[1].edges[_]=y,l[0].copy_vert_info(g),l[1].copy_vert_info(p),s.verts=[r[0],r[2]]}}}}}if(0===a)break}}function FindConvexHull(e){for(var t,n=(e.positions,{}),r=-1,i=0;i<e.edges.length;i++){var a=e.edges[i];if(IsNull(a.polys[0])){if(IsNull(a.polys[1]))continue;t=a.polys[1]}else{if(!IsNull(a.polys[1]))continue;t=a.polys[0]}var o=a.verts[0],s=a.verts[1],l=t.VertexIndexIn(s)-t.VertexIndexIn(o);if(0>l&&(l+=3),1!=l){var c=o;o=s,s=c}n[o]=s,r=o}if(r>=0){for(var d=r,u=[d];;){var f=n[d];if(f==r)break;u.push(f),d=f}e.hull=u}}function FindVoronoiDiagram(e){var t,n,r,i,a,o,s,l,c,d,u,f,h,g,p,v,y,m,b,_,w,x,k;if(1!=e.triangles.length){if(0!==e.triangles.length){for(E=0;E<e.triangles.length;E++)l=e.triangles[E],l.index=E,e.vor_positions.push(l.ccdir);for(var E=0;E<e.edges.length;E++)if(t=e.edges[E],!IsNull(t.polys[0])&&!IsNull(t.polys[1])){var j=[t.polys[0].index,t.polys[1].index];e.vor_edges.push(j)}for(E=0;E<e.indices.length;E++)o=e.indices[E],e.vor_polygons[o]={},s=e.vor_polygons[o],s.edges=[],s.triangles=[],s.boundary=[];for(E=0;E<e.edges.length;E++)for(t=e.edges[E],c=0;2>c;c++)e.vor_polygons[t.verts[c]].edges.push(t);for(E=0;E<e.triangles.length;E++)for(l=e.triangles[E],c=0;3>c;c++)e.vor_polygons[l.verts[c]].triangles.push(l);for(E=0;E<e.indices.length;E++){o=e.indices[E],s=e.vor_polygons[o];var C=s.triangles[0];for(l=C,s.boundary.push(l.index),c=0;3>c&&(t=l.edges[c],!t.IsVertex(o));c++);for(var I=t,O=!1;;){if(d=t.PolyIndexIn(l),l=t.polys[1-d],IsNull(l))break;if(TrianglesEqual(l,C)){O=!0;break}for(s.boundary.push(l.index),c=0;3>c;c++)if(u=l.edges[c],!EdgesEqual(u,t)&&u.IsVertex(o)){t=u;break}}if(!O){for(s.boundary.reverse(),l=C,c=0;3>c&&(t=l.edges[c],EdgesEqual(t,I)||!t.IsVertex(o));c++);for(;;){if(d=t.PolyIndexIn(l),l=t.polys[1-d],IsNull(l))break;for(s.boundary.push(l.index),c=0;3>c;c++)if(u=l.edges[c],!EdgesEqual(u,t)&&u.IsVertex(o)){t=u;break}}}O||(s.boundary.reverse(),s.boundary.push(-1),s.boundary.reverse(),s.boundary.push(-1))}if(e.hull.length>=3){var M=[],T=e.positions,S=e.hull.length;for(c=0;S>c;c++){o=e.hull[c];var L=c+1;L>=S&&(L=0);var A=e.hull[L],D=e.vor_polygons[o].edges,N=e.vor_polygons[A].edges,F=FindSharedEdges(D,N);t=F[0];var q=t.polys[0].index;f=T[o],h=T[A],b=vec_difference(h,f),x=[q,e.vor_positions[q],o,f,A,h,b],M.push(x)}for(;M.length>3;){var z=M.length,P=[],V=[];for(a=0;z>a;a++)V.push([]);for(a=0;z>a;a++)g=a+1,g>=z&&(g=0),m=Normalize(crsprd(M[a][6],M[g][6])),vec_mult_scalar_to(m,-1),V[a].push(P.length),V[g].push(P.length),P.push(m);for(a=0;z>a;a++){if(y=V[a],y.length>=2){for(var G=[],R=0;R<y.length;R++)G.push(ptdist(P[y[R]],M[a][1]));for(var Q=0,H=G[Q],B=0;B<G.length;B++){var U=G[B];H>U&&(Q=B,H=U)}v=y[Q]}else v=1==y.length?y[0]:-1;V[a]=v}var $=[];for(a=0;z>a;a++){g=a+1,g>=z&&(g=0),p=a-1,0>p&&(p=z-1);var W=0;if(y=V[a],-1!=y){var X=V[p];y==X?W=2:(ptitsc_next=V[g],y==ptitsc_next&&(W=1))}if(0===W)$.push(M[a]);else if(1==W){var J=M[a],K=M[g];m=P[a];var Y=J[0],Z=K[0],ee=Z!=Y;if(ee){_=e.vor_positions.length,w=J[2],f=J[3],ix1=K[4],h=K[5];for(var te,ne,re=0;z>re;re++){for(var ie=ptdist(M[re][3],m),ae=re-a;0>ae;)ae+=z;for(;ae>=z;)ae-=z;2>=ae?void 0===te?te=ie:te>ie&&(te=ie):void 0===ne?ne=ie:ne>ie&&(ne=ie)}ee=ne>te}if(ee){b=vec_difference(h,f),x=[_,m,w,f,ix1,h,b],$.push(x),e.vor_positions.push(m);var oe=J[4];e.vor_edges.push([Y,_]),e.vor_edges.push([Z,_]),e.vor_polygons[oe].boundary.shift(),k=e.vor_polygons[oe].boundary.length,e.vor_polygons[oe].boundary[k-1]=_,e.vor_polygons[w].boundary[1]==Y?(e.vor_polygons[w].boundary.unshift(-1),e.vor_polygons[w].boundary[1]=_):(k=e.vor_polygons[w].boundary.length,e.vor_polygons[w].boundary[k-2]==Y&&(e.vor_polygons[w].boundary.push(-1),k=e.vor_polygons[w].boundary.length,e.vor_polygons[w].boundary[k-2]=_)),e.vor_polygons[ix1].boundary[1]==Z?(e.vor_polygons[ix1].boundary.unshift(-1),e.vor_polygons[ix1].boundary[1]=_):(k=e.vor_polygons[ix1].boundary.length,e.vor_polygons[ix1].boundary[k-2]==Z&&(e.vor_polygons[ix1].boundary.push(-1),k=e.vor_polygons[ix1].boundary.length,e.vor_polygons[ix1].boundary[k-2]=_))}else $.push(J),$.push(K)}}if($.length==M.length)break;M=$}if(2==M.length){if(M[0][0]!=M[1][0]){var se=[];for(a=0;2>a;a++)g=M[a][0],se.push(g),g=M[a][2],e.vor_polygons[g].boundary.shift(),e.vor_polygons[g].boundary.pop();e.vor_edges.push(se)}}else if(3==M.length){var le=M[0][0],ce=M[1][0],de=M[2][0];if(le!=ce&&le!=de&&ce!=de)for(_=e.vor_positions.length,n=M[0][3],r=M[1][3],i=M[2][3],m=zerovec(),vec_add_to(m,crsprd(n,r)),vec_add_to(m,crsprd(r,i)),vec_add_to(m,crsprd(i,n)),m=Normalize(m),vec_mult_scalar_to(m,-1),e.vor_positions.push(m),a=0;3>a;a++)x=M[a],e.vor_edges.push([x[0],_]),o=x[2],e.vor_polygons[o].boundary.shift(),k=e.vor_polygons[o].boundary.length,e.vor_polygons[o].boundary[k-1]=_}}for(a=0;a<e.vor_polygons.length;a++)s=e.vor_polygons[a],s.boundary.length>=3&&s.boundary[0]>=0&&(l=new TriangleObject(e.vor_positions,s.boundary.slice(0,3)),l.IsVertexOrderCorrect()||s.boundary.reverse())}else if(2==e.hull.length){n=e.positions[e.hull[0]],r=e.positions[e.hull[1]],f=zerovec(),vec_add_to(f,n),vec_add_to(f,r),f=Normalize(f),e.vor_positions.push(f),h=Normalize(crsprd(n,r)),e.vor_positions.push(h),vt2=vec_copy(f),vec_mult_scalar_to(vt2,-1),e.vor_positions.push(vt2);var ue=vec_copy(h);for(vec_mult_scalar_to(ue,-1),e.vor_positions.push(ue),e.vor_edges.push([0,1,2,3,0]),t=e.edges[0],a=0;2>a;a++)o=e.hull[a],e.vor_polygons[o]={},s=e.vor_polygons[o],s.edges=[t],s.triangles=[0],0===a?s.boundary=[0,1,2,3]:1==a&&(s.boundary=[0,3,2,1])}}else if(3==e.hull.length){for(l=e.triangles[0],e.vor_positions.push(l.ccdir),a=0;3>a;a++){g=a+1,g>=3&&(g=0),p=a-1,0>p&&(p=2),r=e.positions[e.hull[a]],i=e.positions[e.hull[g]];var fe=vec_difference(i,r);e.vor_positions.push(Normalize(crsprd(fe,l.ccdir))),e.vor_edges.push([0,a+1,4]),o=e.hull[a],e.vor_polygons[o]={},s=e.vor_polygons[o];for(var he=e.hull[p],ge=0;3>ge;ge++){t=e.edges[ge];var pe=FindShared([he,o],t.verts);if(2==pe.length)break}s.edges=[t],s.triangles=[l],s.boundary=[0,p+1,4,a+1]}var ve=vec_copy(l.ccdir);vec_mult_scalar_to(ve,-1),e.vor_positions.push(ve)}}function FindDelaunayTriangulationIndexed(e,t){var n,r,i,a,o={};if(o.positions=e,o.indices=t,o.triangles=[],o.edges=[],o.hull=[],o.vor_positions=[],o.vor_edges=[],o.vor_polygons={},t.length<3)return 2==t.length&&(o.edges.push(new EdgeObject(t)),o.hull=t),FindVoronoiDiagram(o),o;var s=new TriangleObject(e,t.slice(0,3));s.IsVertexOrderCorrect()||(s=new TriangleObject(e,[t[0],t[2],t[1]])),o.triangles.push(s);for(var l=new Array(3),c=0;3>c;c++){n=c+1,n>=3&&(n-=3),v=t[c],r=t[n];var d=[v,r];i=new EdgeObject(d);var u=new EdgeCheckObject(e,d);u.edge=i,l[c]=u,s.edges[c]=i,i.polys[0]=s,o.edges.push(i)}var f=t.slice(0,3),h=l,g=Object;for(c=0;3>c;c++)n=c+2,n>=3&&(n-=3),v=t[c],g[v]=[l[c],l[c+1]];for(var p=3;p<t.length;p++){var v=t[p];if(!AddPointInside(o,v)){g[v]=[];for(var y=[],m=[],b=[],_=0;_<f.length;_++){r=f[_],a=new EdgeCheckObject(e,[v,r]);for(var w=!1,x=0;x<h.length;x++){var k=h[x];if(w=a.intersects(e,k))break}w||(i=new EdgeObject(a.verts),a.edge=i,AddUniqueEdge(y,a),AddUniqueEdge(g[v],a),AddUnique(m,v),AddUniqueEdge(g[r],a),AddUnique(m,r))}for(AddUnique(f,v),_=0;_<h.length;_++){a=h[_];for(var E=[],j=0;2>j;j++){var C=FindSharedEdges(g[v],g[a.verts[j]]);0!==C.length&&E.push(C[0])}if(!(E.length<2)){var I=-1;for(j=0;2>j;j++)if(IsNull(a.edge.polys[j])){I=j;break}if(!(0>I)){var O,M=a.edge.polys[1-I],T=a.verts[0],S=M.VertexIndexIn(T),L=a.verts[1],A=M.VertexIndexIn(L),D=A-S;if(0>D&&(D+=3),1==D?O=[v,L,T]:2==D&&(O=[v,T,L]),s=new TriangleObject(e,O),s.IsVertexOrderCorrect())for(o.triangles.push(s),a.edge.polys[I]=s,s.edges[0]=a.edge,s.edges[1]=E[0].edge,s.edges[2]=E[1].edge,AddUniqueEdge(b,a),j=0;2>j;j++){var N=E[j];IsNull(N.edge.polys[0])?(N.edge.polys[0]=s,o.edges.push(N.edge)):(N.edge.polys[1]=s,AddUniqueEdge(b,N))}}}}for(_=0;_<y.length;_++)AddUniqueEdge(h,y[_]);FindSetDifferenceEdges(h,b);var F=[];for(_=0;_<m.length;_++){var q=m[_];FindSetDifferenceEdges(g[q],b),0===g[q].length&&F.push(q)}FindSetDifference(f,F)}}return ImproveTriangulation(o),FindConvexHull(o),FindVoronoiDiagram(o),o}function FindDelaunayTriangulation(e){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=n;return FindDelaunayTriangulationIndexed(e,t)}function MaterialSelect(e){"use strict";this.element_=e,this.maxRows=this.Constant_.NO_MAX_ROWS,this.init()}var niclabs={};niclabs.insight=function(e){"use strict";Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,r;if(null===this)throw new TypeError(" this is null or not defined");var i=Object(this),a=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=t),r=0;a>r;){var o;r in i&&(o=i[r],e.call(n,o,r,i)),r++}}),e.fn.template=function(t){"undefined"==typeof t?t=this.html():"string"==typeof t&&"#"===t.charAt(0)&&(t=e(t).html());var n=this;return this.bind("render",function(r,i){n.empty().append(t),n.find("[data-bind],[data-if]").each(function(){var t=e(this).attr("data-bind")||e(this).attr("data-if"),n=e(this).prop("tagName");t in i?e(this).attr("data-bind")&&("img"===n?e(this).attr("src",i[t]):"input"===n?e(this).val(i[t]):e(this).text(i[t])):e(this).detach()})}),this},e.fn.resizable=function(t){function n(t){o=t.clientX,s=t.clientY,l=g.outerWidth(),c=g.outerHeight(),e(document).on("mousemove",r),e(document).on("mouseup",i)}function r(e){u&&g.css("height",c+e.clientY-s+"px"),d&&g.css("width",l+e.clientX-o+"px"),f&&g.css("top",e.clientY+"px").css("height",c+s-e.clientY+"px"),h&&g.css("width",l-e.clientX+o+"px")}function i(t){e(document).off("mousemove",r),e(document).off("mouseup",i),g.trigger("resize")}var a=e("<div>").addClass("resizer").addClass(t+"-resize");this.append(a).addClass("resizable"),a.on("mousedown",n);var o,s,l,c,d,u,f,h,g=this;return u=t.search("s")>=0,d=t.search("e")>=0,f=t.search("n")>=0,h=t.search("w")>=0,this.scroll(function(e){a.css("top",g.scrollTop())}),this},e.fn.setID=function(e){return"#"===e.charAt(0)&&(e=e.slice(1)),this.attr("id",e),this},e.fn.movable=function(){var t=this.children(".header");0===t.length&&(t=e("<div>").addClass("header"),this.prepend(t));var n=e("<span>").addClass("button").attr("data-icon","up-arrow"),r=e("<span>").addClass("button").attr("data-icon","down-arrow");t.append(n),t.append(r);var i=this;return n.on("click",function(){i.insertBefore(i.prev())}),r.on("click",function(){i.insertAfter(i.next())}),this},e.fn.closable=function(t){t||(t=function(){});var n=this.children(".header");n.length||(n=e("<span>").addClass("header"),this.prepend(n));var r=e("<span>").addClass("button").attr("data-icon","close");n.prepend(r);var i=this;return r.on("click",function(){i.remove(),e("#insight-map-view").width(e("#insight-dashboard").innerWidth()),t()}),this},e.fn.hidable=function(t){var n=!1;n||(n=function(){});var r=e("<span>").addClass("hide-button").attr("data-icon","close"),i=this,a=e("<button>").addClass("mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--fab mdl-button--mini-fab").css("z-index",2).css("background","white"),o=e("<i>").addClass("material-icons hide-show-icon").html("expand_more");e(a).append(o);var s=e("<div>").setID("insight-show-hide-button");"right"==t&&e(s).addClass("show-button-right"),e(".mdl-card__title").append(e("<div>").addClass("mdl-layout-spacer")),e(".mdl-card__title").append(r),i.prepend(s);var l=function(){e(".block").css("z-index",2),e(".filters").css("z-index",2),e("#insight-dashboard").parent().css("overflow-y","auto"),e("#insight-map-view").width(e("#insight-dashboard").innerWidth()),e("#insight-map-view").height(e("#insight-dashboard").parent().height()),e(".mdl-card__title").append(e("<div>").addClass("mdl-layout-spacer")),e(".mdl-card__title").append(r),a.remove(),n(),r.on("click",c)},c=function(){e(".block").css("z-index",-1),e(".filters").css("z-index",-1),e("#insight-dashboard").parent().css("overflow-y","hidden"),e("#insight-map-view").width(e("#insight-dashboard").parent().innerWidth()),e("#insight-map-view").height(e("#insight-dashboard").parent().height()),s.prepend(a),r.remove(),n(),a.on("click",l)};return a.on("click",l),r.on("click",c),this},Array.prototype.indexOf="indexOf"in Array.prototype?Array.prototype.indexOf:function(t,n){return e.inArray(t,this,n)},Object.size=function(e){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n},Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(e,t){var n=this[e],r=function(){return n},i=function(r){return n===r?!1:(t.call(this,e,n,r),void(n=r))};delete this[e]&&Object.defineProperty(this,e,{get:r,set:i,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(e){var t=this[e];delete this[e],this[e]=t}}),Object.prototype.spy||Object.defineProperty(Object.prototype,"spy",{enumerable:!1,configurable:!0,writable:!1,value:function(e){for(var t in this)this.hasOwnProperty(t)&&this.watch(t,e)}}),Object.prototype.unspy||Object.defineProperty(Object.prototype,"unspy",{enumerable:!1,configurable:!0,writable:!1,value:function(){for(var e in this)this.hasOwnProperty(e)&&this.unwatch(e)}});var t,n={};return{handler:function(e,t,r){if(e in n){if(t="undefined"==typeof t?n[e].kind:t,r="undefined"==typeof r?n[e].handler:r,t!==n[e].kind)throw new Error("There already exists a handler with name "+e+" for kind "+n[e].kind)}else if("undefined"==typeof t&&"undefined"==typeof r)throw new Error("Handler "+e+" does not exist");return n[e]={kind:t,handler:r},r},dashboard:function(e){return"undefined"==typeof e?t:t=niclabs.insight.Dashboard(e)}}}(jQuery),niclabs.insight.Color=function(){function e(e,t,n){e/=255,t/=255,n/=255;var r,i,a=Math.max(e,t,n),o=Math.min(e,t,n),s=a,l=a-o;if(i=0===a?0:l/a,a==o)r=0;else{switch(a){case e:r=(t-n)/l+(n>t?6:0);break;case t:r=(n-e)/l+2;break;case n:r=(e-t)/l+4}r/=6}return[r,i,s]}function t(e,t,n){var r,i,a,o=Math.floor(6*e),s=6*e-o,l=n*(1-t),c=n*(1-s*t),d=n*(1-(1-s)*t);switch(o%6){case 0:r=n,i=d,a=l;break;case 1:r=c,i=n,a=l;break;case 2:r=l,i=n,a=d;break;case 3:r=l,i=c,a=n;break;case 4:r=d,i=l,a=n;break;case 5:r=n,i=l,a=c}return[255*r,255*i,255*a]}function n(e){e=Math.floor(e);var t=e.toString(16);return 1==t.length?"0"+t:t}function r(e){return"#"+n(e[0])+n(e[1])+n(e[2])}function i(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}return{rgbToHsv:e,hsvToRgb:t,rgbToHex:r,hexToRgb:i}}(),niclabs.insight.Dashboard=function(e){"use strict";return function(t){function n(e){return e="undefined"==typeof e?d++:e,"layer"+e}var r=["left","right","none"],i="#insight-dashboard",a=0;if(!("anchor"in t))throw new Error("Anchor id is required for creating a dashboard");var o=t.anchor;if(e(o).css("overflow-y","auto"),t.layout=t.layout||"none",r.indexOf(t.layout)<0)throw new Error("Layout must be one of '"+r.join("','")+"'");var s=(e("<div>"),e("<div>").setID(i).addClass("mdl-grid"));e(o).append(s);var l,c={},d=0,u={},f={},h=e("<div>").setID("insight-info-view").addClass("insight-info-view mdl-cell mdl-cell--4-col-phone mdl-cell--3-col-tablet mdl-cell--4-col-desktop");"right"==t.layout&&e(h).css("text-align","-webkit-right");var g=e("<div>").setID("insight-description-view").addClass("mdl-card mdl-shadow--2dp block"),p=e("<div>").addClass("mdl-card__title mdl-card--expand mdl-color--blue-600").append(e("<h2>").addClass("mdl-card__title-text insight-info-view__title").html("Insight")),v=e("<div>").addClass("mdl-card__supporting-text mdl-color--blue-600 insight-info-view__subtitle").append(e("<p>").html("Information about myself. More information here and here.")),y=e("<div>").addClass("mdl-grid mdl-grid--no-spacing"),m=e("<div>").setID("insight-tabs").addClass("mdl-tabs mdl-js-tabs mdl-js-ripple-effect").append(e("<a>").attr("href","#insight-info-tab").addClass("mdl-tabs__tab is-active").html("Information")).append(e("<a>").attr("href","#insight-filter-tab").addClass("mdl-tabs__tab").html("Filters"));m.click(function(){e("#insight-map-view").width(e("#insight-dashboard").innerWidth())});var b=e("<div>").setID("insight-info-tab").addClass("mdl-tabs__panel is-active"),_=e("<div>").setID("insight-filter-tab").addClass("mdl-tabs__panel");e(i).append(h),e(h).prepend(g),e(g).append(p),e(g).append(v),e(m).append(b,_),e(y).append(m),e(g).append(y);var w=e("<div>").setID("insight-empty-view").addClass("mdl-cell mdl-cell--4-col-phone mdl-cell--5-col-tablet mdl-cell--8-col-desktop");"left"==t.layout&&e(i).append(w),"right"==t.layout&&e(i).prepend(w),niclabs.insight.event.on("layer_data",function(e){l&&e.id===l.id&&niclabs.insight.event.trigger("active_layer_data",e)});var x=niclabs.insight.Filters(E);_.append(x.element),e(h).hidable(t.layout);var k=function(){return!0};niclabs.insight.event.on("filter_changed",function(e){k=e,l.filter(k)});var E={get element(){return e(i)[0]},get $(){return e(i)},config:function(e){return t[e]},info:function(t){return"undefined"!=typeof t&&(u="handler"in t?niclabs.insight.handler(t.handler)(E,t):t,e(b).append(u.element)),u},layout:function(){return t.layout},map:function(n){if("undefined"!=typeof n&&(f="handler"in n?niclabs.insight.handler(n.handler)(E,n):n,e(i).prepend(f.element),e(f.element).width(e(i).width()).height(e("body").height()),t.geocoding!==!1&&"googlemap"in f)){var r=niclabs.insight.filter.GoogleGeocodingFilter(E,{id:"geocoder"});e(v).append(r.$)}return f},layer:function(e,t){if("string"==typeof e)return c[e];if("number"==typeof e)return c[n(e)];var r,i;return"handler"in e?(i=e.id=e.id||n(),r=niclabs.insight.handler(e.handler)(E,e)):(r=e,i=r.id),c[i]=r,(t||1===Object.size(c))&&E.active(i),j.add(r.id,r.name),a+=1,r},data:function(e){return l?l.data(e):[]},active:function(e){if("undefined"==typeof e)return"undefined"!=typeof l?l.id:void 0;if("undefined"!=typeof l&&l.clear(),"number"==typeof e&&(e=n(e)),!(e in c))throw new Error("Layer with id "+e+" does not exist");return l=c[e],l.load(),l.filter(k),l},filter:function(e){return x.filter(e)},clear:function(){l&&l.clear()}},j=niclabs.insight.filter.LayerSelector(E,{id:"layer-selector"});return x.filter(j),E}}(jQuery),niclabs.insight.ElementList=function(){var e=function(e){function t(e){return e="undefined"==typeof e?i++:e,"__"+e}var n={},r={},i=0;return n.element=function(n){if("string"==typeof n)return r[n];if("number"==typeof n)return r[t(n)];var i,a;return"handler"in n?(a=n.id=n.id||t(),i=niclabs.insight.handler(n.handler)(e,n)):(i=n,a=i.id),r[a]=i,i},n.each=function(e){for(var t in r)if(e(t,r[t])===!1)return!1},n.remove=function(e){if("number"==typeof obj&&(e=t(e)),e in r){var n=r[e];return delete r[e],n}},n};return e}(),niclabs.insight.Element=function(e){var t=function(e){if(!("id"in e))throw Error("All dashboard elements must define an identifier");var t=e.id;if(!/^[^#. '"]+$/.test(t))throw Error("The dashboard element id must be at least 1 character long and cannot contain the following characters ['#','.',' ', ''', '\"'])");return{get id(){return t}}};return t}(jQuery),niclabs.insight.Filters=function(e){"use strict";return function(e,t){function n(e){var t=!0;return a.each(function(n,r){return r.apply(e)?void 0:(t=!1,e.visible=!1,!1)}),e.visible=!0,t}t=t||{};var r=t.id||"insight-filters",i=niclabs.insight.View({id:r});i.$.addClass("filters");var a=niclabs.insight.ElementList(e);return niclabs.insight.event.on("filter_selected",function(e){niclabs.insight.event.trigger("filter_changed",n)}),i.filter=function(e){var t=a.element(e);return i.append(t),t},i}}(jQuery),niclabs.insight.InfoView=function(e){"use strict";var t=function(e,t){t=t||{};var n=t.id||"insight-blocks",r=niclabs.insight.View({id:n}),i=niclabs.insight.ElementList(e);r.block=function(e){var t=i.element(e);return r.$.append(t.element),t};var a;if(t.blocks)for(a=0;a<t.blocks.length;a++)r.block(t.blocks[a]);return r.$.on("resize",function(e){i.each(function(e,t){t.refresh()})}),niclabs.insight.event.on("remove-block",function(e){i.remove(e.id)}),r};return niclabs.insight.handler("basic-info-view","info-view",t),t}(jQuery),niclabs.insight.Interpolation=function(){function e(e,t,n,r){return n+(r-n)*e/t}function t(t,n,r,i){var a=e(t,n,r[0],i[0]),o=e(t,n,r[1],i[1]),s=e(t,n,r[2],i[2]);return[a,o,s]}function n(e,n,r,i){var a=niclabs.insight.Color.rgbToHsv(r[0],r[1],r[2]),o=niclabs.insight.Color.rgbToHsv(i[0],i[1],i[2]),s=t(e,n,a,o);return niclabs.insight.Color.hsvToRgb(s[0],s[1],s[2])}return{interpolate:e,interpolate3d:t,interpolateRgb:n}}(),niclabs.insight.MapView=function(e){"use strict";return function(t){var n="#insight-map-view",r={lat:t.lat||0,lng:t.lng||0},i=t.zoom||12,a=e("<div>").setID(n).addClass("map"),o={get element(){var t=e(n);return a=0===t.length?a:t,a[0]},get $(){var t=e(n);return a=0===t.length?a:t},center:function(e,t){return r.lat=e="undefined"==typeof e?r.lat:e,r.lng=t="undefined"==typeof t?r.lng:t,r},get lat(){return r.lat},get lng(){return r.lng},get width(){return o.$.width()},get height(){return o.$.height()},zoom:function(e){return i=e="undefined"==typeof e?i:e}};return e(window).resize(function(){e("#insight-map-view").width(e("#insight-dashboard").innerWidth()),e("#insight-map-view").height(e(window).height())}),o}}(jQuery),niclabs.insight.utils=function(){function e(e){var t=document.createElement("a");return t.href=e,t}function t(e){return e.match(r)}var n=/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)?/gi,r=new RegExp(n);return{isValidURL:t,getLocation:e}}(),niclabs.insight.View=function(e){var t=function(t){var n=niclabs.insight.Element(t),r=e("<div>").attr("id",n.id);return Object.defineProperty(n,"$",{get:function(){var t=e("#"+n.id);return r=0===t.length?r:t}}),Object.defineProperty(n,"element",{get:function(){return n.$[0]}}),n.append=function(e){return n.$.append(e.$),n},n};return t}(jQuery),niclabs.insight.data=function(){var e={},t=function(t,n,r){if("undefined"==typeof n){if(!(t in e))throw Error("No data source with id "+t);return e[t]}return e[t]=niclabs.insight.data.Selector(t,n,r),e[t]};return t}(),niclabs.insight.data.Array=function(){var e=function(e){for(var t=niclabs.insight.data.DataSource(e),n=e.src||[],r=0;r<n.length;r++)$.extend(n[r],{visible:!0});return t.forEach=function(e){for(var t=0;t<n.length;t++)e.call(n[t],n[t],t)},t.filteredForEach=function(e){for(var t=0;t<n.length;t++)n[t].visible&&e.call(n[t],n[t],t)},t.filter=function(e){for(var t=0;t<n.length;t++)e.call(n[t],n[t],t)||(n[t].visible=!1)},t.reduce=function(e,t){for(var r=e.call(n[0],t,n[0]),i=1;i<n.length;i++)r=e.call(n[i],r,n[i],i);return r},t.map=function(e){for(var t=n,r=0;r<n.length;r++)t[r]=e.call(n[r],n[r],r);return t},t.asArray=function(){return n},t};return e}(),niclabs.insight.data.DataSource=function(){var e=function(e){var t=niclabs.insight.Element(e);return t.forEach=function(e){throw Error("Not implemented")},t.filteredForEach=function(e){throw Error("Not implemented")},t.filter=function(e){throw Error("Not implemented")},t.reduce=function(e,t){throw Error("Not implemented")},t.map=function(e){throw Error("Not implemented")},t};return e}(),niclabs.insight.data.JSON=function(e){var t=function(t){var n=niclabs.insight.data.DataSource(t);if("string"!=typeof t.src||!niclabs.insight.utils.isValidURL(t.src))throw Error(t.src+" is not a valid URL");var r=[],i=!1,a={};return null!==t.data&&"object"==typeof t.data?a=t.data:null!==t.data&&"string"==typeof t.data&&t.data.split("&").forEach(function(e){var t=e.split("=");a[t[0]]=decodeURIComponent(t[1])}),t.callback&&(a.callback=t.callback),n.forEach=function(n){function o(e,t){for(var n=0;n<e.length;n++)t.call(e[n],e[n],n)}i?o(r,n):e.getJSON(t.src,a,function(a){var s;if(t.listkey)for(r=a[t.listkey],s=0;s<r.length;s++)e.extend(r[s],{visible:!0});else for(r=a,s=0;s<r.length;s++)e.extend(r[s],{visible:!0});i=!0,o(r,n)})},n.filteredForEach=function(n){function o(e,t){for(var n=0;n<e.length;n++)e[n].visible&&t.call(e[n],e[n],n)}i?o(r,n):e.getJSON(t.src,a,function(a){var s;if(t.listkey)for(r=a[t.listkey],s=0;s<r.length;s++)e.extend(r[s],{visible:!0});else for(r=a,s=0;s<r.length;s++)e.extend(r[s],{visible:!0});i=!0,o(r,n)})},n.filter=function(n){function o(e,t){for(var r=0;r<e.length;r++)n.call(e[r],e[r],r)||(e[r].visible=!1)}i?o(r,n):e.getJSON(t.src,a,function(a){var s;if(t.listkey)for(r=a[t.listkey],s=0;s<r.length;s++)e.extend(r[s],{visible:!0});else for(r=a,s=0;s<r.length;s++)e.extend(r[s],{visible:!0});i=!0,o(r,n)})},n.asArray=function(){return i?r:(e.getJSON(t.src,a,function(n){var a;if(t.listkey)for(r=n[t.listkey],a=0;a<r.length;a++)e.extend(r[a],{visible:!0});else for(r=n,a=0;a<r.length;a++)e.extend(r[a],{visible:!0});i=!0,iterate(r,fn)}),r)},n};return t}(jQuery),niclabs.insight.data.Selector=function(e){var t=function(t,n,r){return Array.isArray(n)?(r=e.extend({id:t,src:n},r),niclabs.insight.data.Array(r)):"string"==typeof n?(r=e.extend({id:t,src:n},r),niclabs.insight.data.JSON(r)):"function"==typeof n?(r=e.extend({id:t,src:n.call()},r),niclabs.insight.data.Array(r)):(r=e.extend({id:t,src:[]},r),niclabs.insight.data.Array(r))};return t}(jQuery),niclabs.insight.event=function(){"use strict";function e(e,n){if(e in t)for(var r=0;r<t[e].length;r++)if(t[e][r]===n)return r;return-1}var t={};return{on:function(n,r){var i=e(n,r);return 0>i?(n in t||(t[n]=[]),t[n].push(r)-1):i},off:function(n,r){var i="number"==typeof r?r:e(n,r);return i>=0?(t[n].splice(i,1),!0):!1},trigger:function(e,n){if(e in t)for(var r=0;r<t[e].length;r++)t[e][r](n)}}}(),niclabs.insight.filter={},niclabs.insight.filter.Filter=function(){var e=function(e,t){var n=niclabs.insight.View(t);return n.$.addClass("filter"),n.apply=function(e){return!0},n};return e}(),niclabs.insight.filter.GoogleGeocodingFilter=function(e){var t=function(t,n){var r=niclabs.insight.filter.Filter(t,n);if(!("googlemap"in t.map()))throw new Error("Sorry, Google Geocoding can only be used with Google Maps");var i=new e.maps.Geocoder,a=$("<i>").addClass("material-icons").html("search"),o=$("<div>").addClass("mdl-textfield mdl-js-textfield insight-geocode-textfield"),s=$("<input>").setID("search").addClass("mdl-textfield__input insight-geocode-textfield__input").attr("type","text"),l=$("<label>").addClass("mdl-textfield__label insight-geocode-textfield__label").attr("for","search").html("Enter your location");o.append(s,l),r.$.append(a,o);var c=function(){var n=t.map().googlemap(),r=s.val();i.geocode({address:r},function(t,i){i==e.maps.GeocoderStatus.OK?(n.setCenter(t[0].geometry.location),n.fitBounds(t[0].geometry.bounds)):s.val("not found: "+r)})};return s.on("change",c),r};return niclabs.insight.handler("google-geocoder","filter",t),t}(google),niclabs.insight.filter.LayerSelector=function(e){var t=function(t,n){var r=niclabs.insight.filter.Filter(t,n),i={},a=e("<div>").addClass("mdl-select mdl-js-select mdl-select--floating-label"),o=e("<select>").setID(n.id).addClass("mdl-select__input"),s=e("<label>").addClass("mdl-select__label").attr("for",n.id).attr("name",n.id).text("Select Layer");
return r.$.hide(),o.on("change",function(){t.active(e(this).val())}),r.$.append(a),e(a).append(o),e(a).append(s),r.add=function(t,n){i[t]=n,o.append(e("<option>").attr("value",t).text(n)),Object.keys(i).length>1&&r.$.show()},r};return niclabs.insight.handler("layer-selector","filter",t),t}(jQuery),niclabs.insight.filter.RadioFilter=function(e){var t=function(t,n){function r(e){return!0}var i=niclabs.insight.filter.Filter(t,n),a=n.options||[];e("<div>").addClass("mdl-select mdl-js-select mdl-select--floating-label");i.$.append(e("<div>").addClass("insight-radio-label").text(n.description)),inputs=[];var o=function(t,r,a){var o=e("<label>").addClass("mdl-radio mdl-js-radio mdl-js-ripple-effect").attr("for",t),s=e("<input>").addClass("mdl-radio__button").setID(t).attr("type","radio").attr("name",n.id).attr("value",r);o.append(s),inputs.push(s),o.append(e("<span>").addClass("mdl-radio__label").text(a)),i.$.append(o),i.$.append(e("<br>"))};o(n.id+"__default",0,"No filter");var s=1;a.forEach(function(e){o(n.id+"__"+s,s,e.name),s++});var l=r;return e.each(inputs,function(t){e(this).on("change",function(){l=r;var t=e("input:radio[name=__1]:checked").val();t>0&&(l=a[t-1].filter),niclabs.insight.event.trigger("filter_selected",i)})}),i.apply=function(e){return l(e)},i};return niclabs.insight.handler("radio-filter","filter",t),t}(jQuery),niclabs.insight.filter.SelectionFilter=function(e){var t=function(t,n){function r(e){return!0}var i=niclabs.insight.filter.Filter(t,n),a=n.options||[],o=e("<div>").addClass("mdl-select mdl-js-select mdl-select--floating-label"),s=e("<select>").setID(n.id).addClass("mdl-select__input").append(e("<option>").text(n.description||"")),l=e("<label>").addClass("mdl-select__label").attr("for",n.id).attr("name",n.id).text(n.description);a.forEach(function(t){s.append(e("<option>").text(t.name))});var c=r;return s.on("change",function(){c=r;var t=e(this).prop("selectedIndex");t>0&&(c=a[t-1].filter),niclabs.insight.event.trigger("filter_selected",i)}),i.$.append(o),e(o).append(s),e(o).append(l),i.apply=function(e){return c(e)},i};return niclabs.insight.handler("selection-filter","filter",t),t}(jQuery),niclabs.insight.info=function(){var e=function(e){var t=niclabs.insight.dashboard();if("undefined"==typeof t)throw new Error("Dashboard has not been initialized");return t.info(e)};return e}(),niclabs.insight.info.Block=function(e){"use strict";var t=function(t,n){function r(){niclabs.insight.event.trigger("remove-block",{id:o})}function i(e,t){g=niclabs.insight.event.on("map_element_selected",function(n){t&&n.layer!==t||e.refresh(e.__data__(n))}),p=niclabs.insight.event.on("layer_summary",function(n){t&&n.id!==t||e.refresh(e.__data__(n.data))})}function a(e){niclabs.insight.event.off("map_element_selected",g),niclabs.insight.event.off("layer_summary",p)}if(!("id"in n))throw new Error("All information blocks must have an id");var o=n.id,s="#"===o.charAt(0)?o:"#"+o,l=n.title||"",c={closable:"undefined"==typeof n.closable?!0:n.closable,movable:"undefined"==typeof n.movable?!0:n.movable},d=n.preprocess||function(e){return e},u=e("<div>").addClass("header").append(e("<span>").attr("data-bind","title").addClass("title").append(l)),f=e("<div>").setID(s).addClass("block").append(u);"right"==t.layout()&&f.addClass("right");var h=e("<div>").addClass("content");f.append(h),c.closable&&f.closable(function(){r()}),c.movable&&f.movable(),f.css(c);var g,p,v,y={},m={get id(){return o},get element(){var t=e(s);return f=0===t.length?f:t,f[0]},get $(){var t=e(s);return f=0===t.length?f:t},get layer(){return v},get content(){var t=e(s).find(".content");return h=0===t.length?h:t},title:function(e){return"undefined"!=typeof e&&(l=e,m.$.find(".title").text(e)),l},__data__:function(e){return"undefined"==typeof e?y:y=0===Object.keys(e).length?{}:d(e)},remove:r,data:function(t){return"undefined"==typeof t?y:(v=void 0,a(m),"string"==typeof t?"#"===t.charAt(0)?(v=t.substring(1),y=n.defaults||{},i(m,v),y):(e.getJSON(t,m.__data__),t):"function"==typeof t?m.__data__(t.call(m)):m.__data__(t))},refresh:function(e){}};return"data"in n?m.data(n.data):(i(m),y=n.defaults||{}),m};return t}(jQuery),niclabs.insight.info.ChartistBlock=function(e){var t=function(t,n,r){var i=niclabs.insight.info.Block(t,r),a=r.chartist;i.content.addClass("chartist-viz").append(e("<div>").addClass(a["class"]));var o,s=a.options||{},l=a.responsiveOptions||{},c=a.labels,d=i.refresh;i.refresh=function(e){e="undefined"==typeof e?i.data():e,d(e),e=e.value||e;var t={series:e,labels:"function"==typeof c?c(e):c};o&&o.optionsProvider?o.update(t):o=new n(i.content.find("div")[0],t,s,l)};var u=i.remove;return i.remove=function(){u(),o.detach()},i.refresh(),i},n=function(e,n){var r=t(e,Chartist.Line,n);return r},r=function(e,n){var r=t(e,Chartist.Bar,n);return r},i=function(e,n){var r=t(e,Chartist.Pie,n);return r};return niclabs.insight.handler("chartist-linechart","info-block",n),niclabs.insight.handler("chartist-barchart","info-block",r),niclabs.insight.handler("chartist-piechart","info-block",i),t}(jQuery),niclabs.insight.info.SummaryBlock=function(e){var t=function(e,t){var n=niclabs.insight.info.Block(e,t),r=t.template||'        <h6 class="mdl-card__title-text" data-if="lat">             lat: <span data-bind="lat"> -- </span>             lng: <span data-bind="lng"> -- </span>         </h6>        <dl class="deflist mdl-card__supporting-text">            <dt class="deflist-key" data-if="description">description</dt>             <dd class="deflist-value" data-bind="description">none</dd>             <dt class="deflist-key" data-if="landmark">landmark</dt>             <dd class="deflist-value" data-bind="landmark">none</dd>             <dt class="deflist-key" data-if="fun-fact">fun-fact</dt>             <dd class="deflist-value" data-bind="fun-fact">none</dd>         </dl>        ';n.content.template(r);var i=n.refresh;return n.refresh=function(e){e="undefined"!=typeof e?e:n.data(),i(e),n.content.trigger("render",e)},n.refresh(),n};return niclabs.insight.handler("summary-block","info-block",t),t}(jQuery),niclabs.insight.layer=function(){var e=function(e,t){var n=niclabs.insight.dashboard();if("undefined"==typeof n)throw new Error("Dashboard has not been initialized");return n.layer(e,t)};return e}(),niclabs.insight.layer.DiagramLayer=function(e){var t=function(t,n){function r(n,r){var i;if("type"in r){var o={layer:a.id,data:n};e.extend(o,r),i=niclabs.insight.handler(r.type)(t,o)}else i=r;return i}var i,a=niclabs.insight.layer.Layer(t,n),o=n.diagram||{type:"voronoi-diagram"};return a.draw=function(e){i=r(e,o)},a.clear=function(){i&&i.clear()},a.filter=function(e){},a};return niclabs.insight.handler("diagram-layer","layer",t),t}(jQuery),niclabs.insight.layer.GraphLayer=function(e){var t=function(t,n){function r(n,r,i){var o;if("type"in i){var s={layer:a.id};e.extend(s,i,n[r]),o=niclabs.insight.handler("node")(t,s)}else o=i;return o.clickable(!0),o}function i(n,r,i,o){var s;if("type"in o){var l={layer:a.id};e.extend(l,o,{startNode:n[r],endNode:n[i]}),s=niclabs.insight.handler("edge")(t,l)}else s=o;return s.clickable(!0),s}var a=niclabs.insight.layer.Layer(t,n),o=n.graph||{type:"simple-graph"},s=[],l=[];return a.draw=function(e){rawData=e.asArray();for(var t=0;t<rawData.length;t++)s.push(r(rawData,t,o));for(t=0;t<o.adj.length;t++)for(var n=0;t>n;n++)1==o.adj[t][n]&&l.push(i(rawData,t,n,o))},a.clear=function(){for(var e=0;e<s.length;e++)s[e].clear();for(s=[],e=0;e<l.length;e++)l[e].clear();l=[]},a.filter=function(e){},a};return niclabs.insight.handler("graph-layer","layer",t),t}(jQuery),niclabs.insight.layer.GridLayer=function(){var e=function(e,t){function n(t,n){var r;if("type"in n){var a={layer:i.id,data:t};$.extend(a,n),r=niclabs.insight.handler(n.type)(e,a)}else r=n;return r}var r,i=niclabs.insight.layer.Layer(e,t),a=t.grid||{type:"hexagon"};return i.draw=function(e){r=n(e,a)},i.clear=function(){r&&r.clear()},i.filter=function(e){var t=i.data();t.filter(e),i.clear(),i.draw(t)},i};return niclabs.insight.handler("grid-layer","layer",e),e}(),niclabs.insight.layer.HeatmapLayer=function(e){var t=function(t,n){function r(n,r){var i;if("type"in r){var o={layer:a.id,data:n};e.extend(o,r),i=niclabs.insight.handler(r.type)(t,o)}else i=r;return i}var i,a=niclabs.insight.layer.Layer(t,n),o=n.heatmap||{type:"point-heatmap"};return a.draw=function(e){i=r(e,o)},a.clear=function(){i&&i.clear()},a.filter=function(e){var t=a.data();t.filter(e),a.clear(),a.draw(t)},a};return niclabs.insight.handler("heatmap-layer","layer",t),t}(jQuery),niclabs.insight.layer.Layer=function(e){"use strict";var t=function(t,n){if(!("id"in n))throw Error("All layers must have an id.");var r=n.id,i=n.name||n.id;if(!("data"in n))throw Error("All layers must provide a data source.");var a=!1,o=niclabs.insight.data(n.data),s=n.summary||!1,l=!1,c={get id(){return r},get name(){return i},data:function(e){return"undefined"==typeof e?l||!a?o:a:"string"==typeof e?a=e:(o=e.length?e:[e],l&&c.load(),o)},load:function(){function t(e){if(o=e,niclabs.insight.event.trigger("layer_data",{id:r,data:o}),c.clear(),s){var t=s;"function"==typeof s&&(t=s(o.asArray())),niclabs.insight.event.trigger("layer_summary",{id:r,data:t})}c.draw(o),l=!0}a?e.getJSON(a,t):t(o)},draw:function(e){},filter:function(e){},clear:function(){}};return c};return t}(jQuery),niclabs.insight.layer.MarkerLayer=function(e){var t=function(t,n){function r(n,r){var a;if("type"in r){var o={layer:i.id};e.extend(o,r,n),a=niclabs.insight.handler(o.type)(t,o)}else a=r;return a.clickable(!0),a}var i=niclabs.insight.layer.Layer(t,n),a=n.marker||{type:"simple-marker"},o=[];return i.draw=function(e){e.filteredForEach(function(e,t){o.push(r(e,a))})},i.clear=function(){for(var e=0;e<o.length;e++)o[e].clear();o=[]},i.filter=function(e){var t=i.data();t.filter(e),i.clear(),i.draw(t)},i};return niclabs.insight.handler("marker-layer","layer",t),t}(jQuery),niclabs.insight.map=function(){"undefined"==typeof Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180}),"undefined"==typeof Number.prototype.toDeg&&(Number.prototype.toDeg=function(){return 180*this/Math.PI});var e=function(e){var t=niclabs.insight.dashboard();if("undefined"==typeof t)throw new Error("Dashboard has not been initialized");return t.map(e)};return e}();var style=[{featureType:"administrative",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#444444"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#e9e9e9"}]},{featureType:"landscape",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{hue:"#0bff00"},{lightness:"74"}]},{featureType:"poi.park",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#77c3c6"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"on"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"road.local",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#004787"},{visibility:"on"},{lightness:"84"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]}];niclabs.insight.map.GoogleMercator=function(){function e(e,t,n){return null!==t&&(e=Math.max(e,t)),null!==n&&(e=Math.min(e,n)),e}var t=256,n={x:t/2,y:t/2},r=t/360,i=t/(2*Math.PI);return{geographic:function(e){var t=(e.x-n.x)/r,a=(e.y-n.y)/-i,o=(2*Math.atan(Math.exp(a))-Math.PI/2).toDeg();return{lat:o,lng:t}},cartesian:function(t){"function"==typeof t.lat&&"function"==typeof t.lng&&(t={lat:t.lat(),lng:t.lng()});var a=n.x+t.lng*r,o=e(Math.sin(t.lat.toRad()),-.9999,.9999),s=n.y+.5*Math.log((1+o)/(1-o))*-i;return{x:a,y:s}},distance:function(e,t){return t="undefined"!=typeof t?t:12,e/(1<<t)}}}(),niclabs.insight.map.GoogleMap=function(e){"use strict";var t=function(e,t){var n=niclabs.insight.MapView(t),r=new google.maps.Map(n.element,{zoom:n.zoom(),center:new google.maps.LatLng(n.lat,n.lng),disableDefaultUI:!0}),i=n.zoom;google.maps.event.addListener(r,"zoom_changed",function(){i(r.getZoom())}),n.zoom=function(e){return e=i(e),r.setZoom(e),e};var a=n.center;return google.maps.event.addListener(r,"center_changed",function(){var e=r.getCenter();a(e.lat(),e.lng())}),n.center=function(e,t){var n=a(e,t);return r.setCenter({lat:n.lat,lng:n.lng}),n},n.googlemap=function(){return r},n};return niclabs.insight.handler("google-map","map-view",t),t}(jQuery),niclabs.insight.quadtree={},niclabs.insight.quadtree.Bounds=function(){var e=function(e,t){var n={x:(e.x+t.x)/2,y:(e.y+t.y)/2};return{get center(){return n},get min(){return e},get max(){return t},contains:function(n){return e.x<=n.x&&n.x<t.x&&e.y<=n.y&&n.y<t.y},intersects:function(n){return t.x<n.min.x?!1:e.x>n.max.x?!1:t.y<n.min.y?!1:e.y>n.max.y?!1:!0}}};return e}(),niclabs.insight.quadtree.PointQuadTree=function(){var e=function(t,n,r){function i(){a=e(niclabs.insight.quadtree.Bounds(t.min,t.center),n,r-1),o=e(niclabs.insight.quadtree.Bounds({x:t.center.x,y:t.min.y},{x:t.max.x,y:t.center.y}),n,r-1),s=e(niclabs.insight.quadtree.Bounds({x:t.min.x,y:t.center.y},{x:t.center.x,y:t.max.y}),n,r-1),l=e(niclabs.insight.quadtree.Bounds(t.center,t.max,n,r-1))}n=n||50,r=r||40;var a,o,s,l,c=[],d={get capacity(){return n},get bounds(){return t},insert:function(e){return t.contains(e)?c.length<n||0>=r?(c.push(e),!0):(void 0===a&&i(),a.insert(e)?!0:o.insert(e)?!0:s.insert(e)?!0:l.insert(e)?!0:!1):!1},query:function(e,n){if(n="undefined"==typeof n?[]:n,!t.intersects(e))return n;for(var r=0;r<c.length;r++)e.contains(c[r])&&n.push(c[r]);return void 0===a?n:(a.query(e,n),o.query(e,n),s.query(e,n),l.query(e,n),n)}};return d};return e}(),niclabs.insight.map.diagram=function(e){return{createLines:function(e,t){var n=180/Math.PI;if(!(t.length<2)){for(var r=e[t[0]],i=[r],a=0,o=1;o<t.length;o++)a=e[t[o]],i=i.concat(this.SplitSegment(r,a),[a]),r=a;for(var s=[],l=0;l<i.length;l++){a=i[l];var c=n*Math.atan2(a[2],Math.sqrt(a[0]*a[0]+a[1]*a[1])),d=n*Math.atan2(a[1],a[0]);s.push([c,d])}return s}},SplitSegment:function(e,t){for(var n=0,r=0;3>r;r++){var i=t[r]-e[r];n+=i*i}var a=[];if(.01>n)return a;var o=new Array(3);for(r=0;3>r;r++)o[r]=e[r]+t[r];var s=0;for(r=0;3>r;r++)pc=o[r],s+=pc*pc;var l=1/Math.sqrt(s);for(r=0;3>r;r++)o[r]*=l;return a.concat(this.SplitSegment(e,o),[o],this.SplitSegment(o,t))},transformMapPositions:function(e){var t=Math.PI/180,n=[];for(i=0;i<e.length;i++){for(var r=e[i],a=t*r.lat,o=t*r.lng,s=Math.cos(a),l=[s*Math.cos(o),s*Math.sin(o),Math.sin(a)],c=0;3>c;c++)l[c]+=1e-10*(2*Math.random()-1);var d=0;for(c=0;3>c;c++)d+=l[c]*l[c];var u=1/Math.sqrt(d);for(c=0;3>c;c++)l[c]*=u;n.push(l)}return n}}}(jQuery),niclabs.insight.map.diagram.DelaunayDiagram=function(e){var t=function(e,t){function n(e){for(var n=[],r=e.length,i=[],a=0;r>a;a++)i[a]=new google.maps.LatLng(e[a].lat,e[a].lng);var o=niclabs.insight.map.diagram.transformMapPositions(e),s=FindDelaunayTriangulation(o),l=[];for(a=0;a<s.edges.length;a++){var c=s.edges[a];n=niclabs.insight.map.diagram.createLines(s.positions,c.verts);for(var d=[],u=0;u<n.length;u++)d.push(new google.maps.LatLng(n[u][0],n[u][1]));var f=new google.maps.Polyline({path:d,strokeColor:t.strokeColor||"#FF0000",strokeWeight:t.strokeWeight||2,strokeOpacity:t.strokeOpacity||1,clickable:!1});l.push(f)}for(markers=[],a=0;a<i.length;a++){var h=new google.maps.Marker({position:i[a],title:e[a].landmark||""});markers[a]=h}return{Polylines:l,Markers:markers}}if(!("data"in t))throw Error("No data provided for the diagram");var r=niclabs.insight.map.diagram.Diagram(e,t),i=n(t.data);r.setMap(i,r.map.googlemap());var a=r.clear;return r.clear=function(){a(),r.setMap(i,null)},r};return niclabs.insight.handler("delaunay-diagram","diagram",t),t}(jQuery),niclabs.insight.map.diagram.Diagram=function(e){var t=function(e,t){if(!("layer"in t))throw new Error("The Diagram must be associated to a layer");var n;if(!(n=e.layer(t.layer)))throw new Error("The layer "+n+" does not exist in the dashboard");var r;if(!(r=e.map()))throw new Error("No map has been initialized for the dashboard yet");if(!("googlemap"in r))throw new Error("Diagrams are only supported for Google Maps at the moment");var i={get map(){return r},get layer(){return n},clear:function(){},setMap:function(e,t){for(var n in e.Polylines)e.Polylines[n].setMap(t);for(var r in e.Markers)e.Markers[r].setMap(t)}};return i};return t}(jQuery),niclabs.insight.map.diagram.VoronoiDiagram=function(e){var t=function(e,t){function n(e){for(var n=[],r=e.length,i=[],a=0;r>a;a++)i[a]=new google.maps.LatLng(e[a].lat,e[a].lng);var o=niclabs.insight.map.diagram.transformMapPositions(e),s=FindDelaunayTriangulation(o),l=[];for(a=0;a<s.vor_edges.length;a++){var c=s.vor_edges[a];if(!(c[0]<0||c[1]<0)){n=niclabs.insight.map.diagram.createLines(s.vor_positions,c);for(var d=[],u=0;u<n.length;u++)d.push(new google.maps.LatLng(n[u][0],n[u][1]));var f=new google.maps.Polyline({path:d,strokeColor:t.strokeColor||"#FF0000",strokeWeight:t.strokeWeight||2,strokeOpacity:t.strokeOpacity||1,clickable:!1});l.push(f)}}for(markers=[],a=0;a<i.length;a++){var h=new google.maps.Marker({position:i[a],title:e[a].landmark||""});markers[a]=h}return{Polylines:l,Markers:markers}}if(!("data"in t))throw Error("No data provided for the diagram");var r=niclabs.insight.map.diagram.Diagram(e,t),i=n(t.data);r.setMap(i,r.map.googlemap());var a=r.clear;return r.clear=function(){a(),r.setMap(i,null)},r};return niclabs.insight.handler("voronoi-diagram","diagram",t),t}(jQuery),niclabs.insight.map.graph={},niclabs.insight.map.graph.Edge=function(e){var t=function(e,t){var n=niclabs.insight.map.graph.GraphElement(e,t),r=[];r[0]=new google.maps.LatLng(t.startNode.lat,t.startNode.lng),r[1]=new google.maps.LatLng(t.endNode.lat,t.endNode.lng);var i=new google.maps.Polyline({path:r,strokeColor:"#000000",strokeOpacity:1,strokeWeight:10});return i.setMap(n.map.googlemap()),n.graphElement=function(){return i},n.clickable=function(){var e=n.graphElement();return listener=google.maps.event.addListener(e,"click",function(){niclabs.insight.event.trigger("map_element_selected",t),"setOptions"in e&&(e.setOptions({strokeColor:"#FF0000"}),setTimeout(function(){e.setOptions({strokeColor:"#000000"})},1e3))}),listener},n};return niclabs.insight.handler("edge","graph",t),t}(jQuery),niclabs.insight.map.graph.GraphElement=function(e){var t=function(e,t){if(!("layer"in t))throw new Error("The marker must be associated to a layer");var n;if(!(n=e.layer(t.layer)))throw new Error("The layer "+n+" does not exist in the dashboard");var r;if(!(r=e.map()))throw new Error("No map has been initialized for the dashboard yet");if(!("googlemap"in r))throw new Error("Markers are only supported for Google Maps at the moment");var i={get map(){return r},get layer(){return n},graphElement:function(){return void 0},clickable:function(e){},clear:function(){var e=i.graphElement();e.setMap(null)},visible:function(e){return"undefined"==typeof e?i.graphElement().getVisible():(i.graphElement().setVisible(e),e)}};return i};return t}(jQuery),niclabs.insight.map.graph.Node=function(e){var t=function(e,t){var n=niclabs.insight.map.graph.GraphElement(e,t),r=new google.maps.LatLng(parseFloat(t.lat),parseFloat(t.lng)),i=new google.maps.Marker({position:r,map:n.map.googlemap(),title:t.landmark||""});return n.graphElement=function(){return i},n.clickable=function(){var e=n.graphElement();return listener=google.maps.event.addListener(e,"click",function(){niclabs.insight.event.trigger("map_element_selected",t),"setAnimation"in e&&(e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},1e3))}),listener},n};return niclabs.insight.handler("node","graph",t),t}(jQuery),niclabs.insight.map.grid={},niclabs.insight.map.grid.Grid=function(){function e(e,t){return e=niclabs.insight.Color.hexToRgb(e),t=niclabs.insight.Color.hexToRgb(t),function(n){var r=0,a=0;for(i=0;i<n.length;i++)"weight"in n[i]&&(r+=n[i].weight,a++);return a>0?(r/=a,niclabs.insight.Color.rgbToHex(niclabs.insight.Interpolation.interpolateRgb(r,1,e,t))):"#ffffff"}}function t(e){return function(t){var n=0;for(hist={},i=0;i<t.length;i++)"weight"in t[i]&&"category"in t[i]&&(t[i].category in hist?hist[t[i].category]+=t[i].weight:hist[t[i].category]=t[i].weight,n++);var r=[];for(var a in hist)r.push([a,hist[a]]);return r.sort(function(e,t){return t[1]-e[1]}),n>0?e[r[0][0]]:"#ffffff"}}function n(e,t){function n(e,t,n){for(var r,i=Math.floor((t+n)/2);n>=t;){for(;e[t].weight<e[i].weight;)t++;for(;e[n].weight>e[i].weight;)n--;n>=t&&(r=e[t],e[t]=e[n],e[n]=r,t++,n--)}return i}return e=niclabs.insight.Color.hexToRgb(e),t=niclabs.insight.Color.hexToRgb(t),function(r){var i=0,a=0,o=r.length>0?r.length-1:0,s=Math.floor((a+o)/2);for(i=n(r,a,o);i!==s;)i=s>i?n(r,s,o):n(r,a,s);return niclabs.insight.Color.rgbToHex(niclabs.insight.Interpolation.interpolateRgb(r[i].weight,1,e,t))}}var r=function(r,i){function a(){return"#ffffff"}function o(e){return function(){niclabs.insight.event.trigger("map_element_selected",e)}}function s(){for(var e=0;e<f.length;e++)f[e].setMap(null)}function l(e){e="undefined"!=typeof e?e:u.googlemap().getBounds(),s(),c(e),y.toggle(!0)}function c(e){if(e){for(var t,n,r=m.tile(),i=v.query(niclabs.insight.quadtree.Bounds(niclabs.insight.map.GoogleMercator.cartesian({lat:e.getNorthEast().lat(),lng:e.getSouthWest().lng()}),niclabs.insight.map.GoogleMercator.cartesian({lat:e.getSouthWest().lat(),lng:e.getNorthEast().lng()}))),a=[],s=0;s<i.length;s++){var l=r.query(i[s]);t=l[0],n=l[1],a[t]||(a[t]=[]),a[t][n]||(a[t][n]=[]),a[t][n].push(i[s])}f=[];for(t in a)for(n in a[t]){h.fillColor=g(a[t][n]);var c=r.draw(r.origin(t,n),m.map,h);google.maps.event.addListener(c,"click",o(a[t][n])),f.push(c)}}}if(console.log(i),!("layer"in i))throw new Error("The grid must be associated to a layer");var d;if(!(d=r.layer(i.layer)))throw new Error("The layer "+d+" does not exist in the dashboard");var u;if(!(u=r.map()))throw new Error("No map has been initialized for the dashboard yet");if(!("googlemap"in u))throw new Error("Grids are only supported for Google Maps at the moment");var f=[],h={strokeColor:"strokeColor"in i?i.strokeColor:"#000000",strokeOpacity:"strokeOpacity"in i?i.strokeOpacity:.6,strokeWeight:"strokeWeight"in i?i.strokeWeight:2,fillOpacity:"fillOpacity"in i?i.fillOpacity:.6},g=i.fill||a;"string"==typeof g&&(g="#"===i.fill.charAt(0)?function(){return i.fill}:"average"===i.fill?e(i.fillStart||"#ff0000",i.fillEnd||"#00ff00"):"median"===i.fill?n(i.fillStart||"#ff0000",i.fillEnd||"#00ff00"):"category"===i.fill?t(i.colorMap):a);var p=niclabs.insight.quadtree.Bounds(niclabs.insight.map.GoogleMercator.cartesian({lat:90,lng:-180}),niclabs.insight.map.GoogleMercator.cartesian({lat:-90,lng:180})),v=niclabs.insight.quadtree.PointQuadTree(p);i.data.filteredForEach(function(e){var t=niclabs.insight.map.GoogleMercator.cartesian(e);e.x=t.x,e.y=t.y,v.insert(e)});var y=function(){var e;return{toggle:function(t){t&&"undefined"==typeof e?e=google.maps.event.addListener(m.map.googlemap(),"bounds_changed",function(){l(this.getBounds())}):t||"undefined"==typeof e||(google.maps.event.removeListener(e),e=void 0)}}}(),m={get map(){return u},get layer(){return d},refresh:l,tile:function(){throw new Error("Not implemented")},clear:function(){s(),y.toggle(!1)}};return m};return r}(),niclabs.insight.map.grid.HexagonTile=function(){var e=function(e){var t=Math.cos(Math.PI/6)*e,n=Math.sin(Math.PI/6)*e,r=niclabs.insight.map.grid.Tile();return Object.defineProperty(r,"s",{get:function(){return e}}),Object.defineProperty(r,"r",{get:function(){return t}}),Object.defineProperty(r,"h",{get:function(){return n}}),r.origin=function(){var r,i;1==arguments.length?(r=arguments[0][0],i=arguments[0][1]):(r=arguments[0],i=arguments[1]);var a=2*r*t+(1&i)*t+t,o=i*(n+e);return{x:a,y:o}},r.query=function(r){r.lat&&(r=niclabs.insight.map.GoogleMercator.cartesian(r));var i=Math.floor(r.x/(2*t)),a=Math.floor(r.y/(n+e)),o=r.x-2*i*t,s=r.y-a*(n+e),l=0===(1&a),c=i,d=a;return l?t>=o&&-n/t*o+n>s?(c=i-1,d=a-1):o>t&&n/t*o-n>s&&(c=i,d=a-1):t>=o?n/t*o>s?(c=i,d=a-1):(c=i-1,d=a):o>t&&-n/t*o+2*n>s&&(c=i,d=a-1),[c,d]},r.vertices=function(r){r.lat&&(r=niclabs.insight.map.GoogleMercator.cartesian(r));var i=[];return i[0]={x:r.x,y:r.y},i[1]={x:r.x+t,y:r.y+n},i[2]={x:r.x+t,y:r.y+e+n},i[3]={x:r.x,y:r.y+e+n+n},i[4]={x:r.x-t,y:r.y+e+n},i[5]={x:r.x-t,y:r.y+n},i},r};return e}(),niclabs.insight.map.grid.HexagonalGrid=function(){var e=function(e,t){var n=niclabs.insight.map.grid.Grid(e,t);return n.tile=function(){return niclabs.insight.map.grid.HexagonTile(niclabs.insight.map.GoogleMercator.distance(t.size,n.map.zoom()))},n.refresh(),n};return niclabs.insight.handler("hexagon","grid",e),e}(),niclabs.insight.map.grid.SquareGrid=function(){var e=function(e,t){var n=niclabs.insight.map.grid.Grid(e,t);return n.tile=function(){return niclabs.insight.map.grid.SquareTile(niclabs.insight.map.GoogleMercator.distance(t.size,n.map.zoom()))},n.refresh(),n};return niclabs.insight.handler("square","grid",e),e}(),niclabs.insight.map.grid.SquareTile=function(){var e=function(e){var t=niclabs.insight.map.grid.Tile();return Object.defineProperty(t,"s",{get:function(){return e}}),t.origin=function(){var t,n;1==arguments.length?(t=arguments[0][0],n=arguments[0][1]):(t=arguments[0],n=arguments[1]);var r=t*e,i=n*e;return{x:r,y:i}},t.query=function(t){t.lat&&(t=niclabs.insight.map.GoogleMercator.cartesian(t));var n=Math.floor(t.x/e),r=Math.floor(t.y/e);return[n,r]},t.vertices=function(t){t.lat&&(t=niclabs.insight.map.GoogleMercator.cartesian(t));var n=[];return n[0]={x:t.x,y:t.y},n[1]={x:t.x,y:t.y+e},n[2]={x:t.x+e,y:t.y+e},n[3]={x:t.x+e,y:t.y},n},t};return e}(),niclabs.insight.map.grid.Tile=function(){var e=function(){var e={origin:function(e,t){throw new Error("Not implemented")},query:function(e){throw new Error("Not implemented")},vertices:function(e){throw new Error("Not implemented")},draw:function(t,n,r){if(!("googlemap"in n))throw new Error("Sorry, I only know how to draw on Google Maps at the moment");for(var i=e.vertices(t),a=[],o=0;o<i.length;o++)a.push(niclabs.insight.map.GoogleMercator.geographic(i[o]));r=r||{strokeColor:"#000000",strokeOpacity:.6,strokeWeight:2,fillColor:"#ffffff",fillOpacity:.6},r.paths=a,r.geodesic=!0;var s=new google.maps.Polygon(r);return s.setMap(n.googlemap()),s}};return e};return e}(),niclabs.insight.map.heatmap={},niclabs.insight.map.heatmap.Heatmap=function(e){var t=function(e,t){if(!("layer"in t))throw new Error("The heatmap must be associated to a layer");var n;if(!(n=e.layer(t.layer)))throw new Error("The layer "+n+" does not exist in the dashboard");var r;if(!(r=e.map()))throw new Error("No map has been initialized for the dashboard yet");if(!("googlemap"in r))throw new Error("Heatmaps are only supported for Google Maps at the moment");var i={get map(){return r},get layer(){return n},clear:function(){}};return i};return t}(jQuery),niclabs.insight.map.heatmap.PointHeatmap=function(e){var t=function(e,t){function n(e){var n=new google.maps.MVCArray;return e.filteredForEach(function(e,t){"weight"in e?n.push({location:new google.maps.LatLng(e.lat,e.lng),weight:e.weight}):n.push(new google.maps.LatLng(e.lat,e.lng))}),new google.maps.visualization.HeatmapLayer({data:n,radius:t.radius||10})}if(!("data"in t))throw Error("No data provided for the heatmap");var r=niclabs.insight.map.heatmap.Heatmap(e,t),i=n(t.data);"undefined"!=typeof t.dissipating&&i.set("dissipating",t.dissipating),"undefined"!=typeof t.gradient&&i.set("gradient",t.gradient),"undefined"!=typeof t.opacity&&i.set("opacity",t.opacity),i.setMap(r.map.googlemap());var a=r.clear;return r.clear=function(){a(),i.setMap(null)},r};return niclabs.insight.handler("point-heatmap","heatmap",t),t}(jQuery),niclabs.insight.map.heatmap.SegmentHeatmap=function(e){var t=function(e,t){function n(e){var n=new google.maps.MVCArray;return e.filteredForEach(function(e,t){segment_size=e.coordinates.length;for(var r=0;r<segment_size-1;r++)for(var i=Math.sqrt(Math.pow(e.coordinates[r+1][0]-e.coordinates[r][0],2)+Math.pow(e.coordinates[r+1][1]-e.coordinates[r][1],2)),a=Math.floor(i/1e-5),o={lat:(e.coordinates[r+1][0]-e.coordinates[r][0])/a,lng:(e.coordinates[r+1][1]-e.coordinates[r][1])/a},s=0;a>s;s++)"weight"in e?n.push({location:new google.maps.LatLng(e.coordinates[r][0]+o.lat*s,e.coordinates[r][1]+o.lng*s),weight:e.weight}):n.push(new google.maps.LatLng(e.coordinates[r][0]+o.lat*s,e.coordinates[r][1]+o.lng*s))}),new google.maps.visualization.HeatmapLayer({data:n,radius:t.radius||10})}if(!("data"in t))throw Error("No data provided for the heatmap");var r=niclabs.insight.map.heatmap.Heatmap(e,t),i=n(t.data);"undefined"!=typeof t.dissipating&&i.set("dissipating",t.dissipating),"undefined"!=typeof t.gradient&&i.set("gradient",t.gradient),"undefined"!=typeof t.opacity&&i.set("opacity",t.opacity),i.setMap(r.map.googlemap());var a=r.clear;return r.clear=function(){a(),i.setMap(null)},r};return niclabs.insight.handler("segment-heatmap","heatmap",t),t}(jQuery),niclabs.insight.map.marker={},niclabs.insight.map.marker.CircleMarker=function(e){var t=function(e,t){var n=niclabs.insight.map.marker.Marker(e,t),r=new google.maps.LatLng(parseFloat(t.lat),parseFloat(t.lng)),i=new google.maps.Circle({center:r,map:n.map.googlemap(),radius:t.radius||400,strokeColor:t.strokeColor||"#FF0000",strokeOpacity:t.strokeOpacity||.8,strokeWeight:t.strokeWeight||2,fillColor:t.fillColor||"#FF0000",fillOpacity:t.fillOpacity||.35,title:t.landmark||""});return n.marker=function(){return i},n};return niclabs.insight.handler("circle-marker","marker",t),t}(jQuery),niclabs.insight.map.marker.ImageMarker=function(e){var t=function(e,t){var n=niclabs.insight.map.marker.Marker(e,t),r=new google.maps.LatLng(parseFloat(t.lat),parseFloat(t.lng));if(!("src"in t))throw new Error("An image source must be provided for using image markers");var i={url:t.src,scaledSize:new google.maps.Size(30,50)},a=new google.maps.Marker({position:r,map:n.map.googlemap(),icon:i,title:t.landmark||""});return n.marker=function(){return a},n};return niclabs.insight.handler("image-marker","marker",t),t}(jQuery),niclabs.insight.map.marker.Marker=function(e){var t=function(e,t){if(!("layer"in t))throw new Error("The marker must be associated to a layer");var n;if(!(n=e.layer(t.layer)))throw new Error("The layer "+n+" does not exist in the dashboard");var r;if(!(r=e.map()))throw new Error("No map has been initialized for the dashboard yet");if(!("googlemap"in r))throw new Error("Markers are only supported for Google Maps at the moment");var i,a={get map(){return r},get layer(){return n},marker:function(){return void 0},clickable:function(e){if(e){var n=a.marker();i=google.maps.event.addListener(n,"click",function(){niclabs.insight.event.trigger("map_element_selected",t),"setAnimation"in n&&(n.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){n.setAnimation(null)},3e3))})}else"undefined"!=typeof i&&(google.maps.event.removeListener(i),i=void 0);return void 0!==i},clear:function(){var e=a.marker();e.setMap(null);
},visible:function(e){return"undefined"==typeof e?a.marker().getVisible():(a.marker().setVisible(e),e)}};return a};return t}(jQuery),niclabs.insight.map.marker.SimpleMarker=function(e){var t=function(e,t){var n=niclabs.insight.map.marker.Marker(e,t),r=new google.maps.LatLng(parseFloat(t.lat),parseFloat(t.lng)),i=new google.maps.Marker({position:r,map:n.map.googlemap(),title:t.landmark||""});return n.marker=function(){return i},n};return niclabs.insight.handler("simple-marker","marker",t),t}(jQuery),TriangleObject.prototype.copy_vert_info=function(e){this.verts=e.verts,this.dirs=e.dirs,this.vol=e.vol,this.ccdir=e.ccdir,this.ccdsq=e.ccdsq},TriangleObject.prototype.IsVertexOrderCorrect=function(){return this.vol>=0},TriangleObject.prototype.IsPointInside=function(e){for(var t=0;3>t;t++)if(dotprd(e,this.dirs[t])<0)return!1;return!0},TriangleObject.prototype.IsPointInCircumcircle=function(e){return ptdist(this.ccdir,e)<this.ccdsq},TriangleObject.prototype.IsVertex=function(e){for(var t=0;3>t;t++)if(e==this.verts[t])return!0;return!1},TriangleObject.prototype.VertexIndexIn=function(e){for(var t=0;3>t;t++)if(e==this.verts[t])return t;return-1},TriangleObject.prototype.EdgeIndexIn=function(e){for(var t=0;3>t;t++)if(EdgesEqual(this.edges[t],e))return t;return-1},EdgeObject.prototype.IsVertex=function(e){for(var t=0;2>t;t++)if(e==this.verts[t])return!0;return!1},EdgeObject.prototype.VertexIndexIn=function(e){for(var t=0;2>t;t++)if(e==this.verts[t])return t;return-1},EdgeObject.prototype.PolyIndexIn=function(e){for(var t=0;2>t;t++)if(TrianglesEqual(this.polys[t],e))return t;return-1},EdgeCheckObject.prototype.intersects=function(e,t){for(var n=0;2>n;n++)for(var r=0;2>r;r++)if(this.verts[n]==t.verts[r])return!1;var i=Normalize(crsprd(this.direc,t.direc)),a=dotprd(i,this.midpnt)>0,o=dotprd(i,t.midpnt)>0;if(o!=a)return!1;var s,l=[];for(n=0;2>n;n++)s=ptdist(i,e[this.verts[n]]),l.push(s);var c=[];for(n=0;2>n;n++)s=ptdist(i,e[t.verts[n]]),c.push(s);var d=max(l[0],l[1]),u=max(c[0],c[1]);if(d<=this.pdst&&u<=t.pdst&&a)return!0;for(vec_mult_scalar_to(i,-1),a=!a,n=0;2>n;n++)l[n]=-l[n],c[n]=-c[n];return d=max(l[0],l[1]),u=max(c[0],c[1]),d<=this.pdst&&u<=t.pdst&&a?!0:!1},MaterialSelect.prototype.Constant_={NO_MAX_ROWS:-1,MAX_ROWS_ATTRIBUTE:"maxrows"},MaterialSelect.prototype.CssClasses_={LABEL:"mdl-textfield__label",INPUT:"mdl-select__input",IS_DIRTY:"is-dirty",IS_FOCUSED:"is-focused",IS_DISABLED:"is-disabled",IS_INVALID:"is-invalid",IS_UPGRADED:"is-upgraded"},MaterialSelect.prototype.onKeyDown_=function(e){"use strict";var t=e.target.value.split("\n").length;13===e.keyCode&&t>=this.maxRows&&e.preventDefault()},MaterialSelect.prototype.onFocus_=function(e){"use strict";this.element_.classList.add(this.CssClasses_.IS_FOCUSED)},MaterialSelect.prototype.onBlur_=function(e){"use strict";this.element_.classList.remove(this.CssClasses_.IS_FOCUSED)},MaterialSelect.prototype.updateClasses_=function(){"use strict";this.checkDisabled(),this.checkValidity(),this.checkDirty()},MaterialSelect.prototype.checkDisabled=function(){"use strict";this.input_.disabled?this.element_.classList.add(this.CssClasses_.IS_DISABLED):this.element_.classList.remove(this.CssClasses_.IS_DISABLED)},MaterialSelect.prototype.checkValidity=function(){"use strict";this.input_.validity.valid?this.element_.classList.remove(this.CssClasses_.IS_INVALID):this.element_.classList.add(this.CssClasses_.IS_INVALID)},MaterialSelect.prototype.checkDirty=function(){"use strict";this.input_.value&&this.input_.value.length>0?this.element_.classList.add(this.CssClasses_.IS_DIRTY):this.element_.classList.remove(this.CssClasses_.IS_DIRTY)},MaterialSelect.prototype.disable=function(){"use strict";this.input_.disabled=!0,this.updateClasses_()},MaterialSelect.prototype.enable=function(){"use strict";this.input_.disabled=!1,this.updateClasses_()},MaterialSelect.prototype.change=function(e){"use strict";e&&(this.input_.value=e),this.updateClasses_()},MaterialSelect.prototype.init=function(){"use strict";this.element_&&(this.label_=this.element_.querySelector("."+this.CssClasses_.LABEL),this.input_=this.element_.querySelector("."+this.CssClasses_.INPUT),this.input_&&(this.input_.hasAttribute(this.Constant_.MAX_ROWS_ATTRIBUTE)&&(this.maxRows=parseInt(this.input_.getAttribute(this.Constant_.MAX_ROWS_ATTRIBUTE),10),isNaN(this.maxRows)&&(this.maxRows=this.Constant_.NO_MAX_ROWS)),this.boundUpdateClassesHandler=this.updateClasses_.bind(this),this.boundFocusHandler=this.onFocus_.bind(this),this.boundBlurHandler=this.onBlur_.bind(this),this.input_.addEventListener("input",this.boundUpdateClassesHandler),this.input_.addEventListener("focus",this.boundFocusHandler),this.input_.addEventListener("blur",this.boundBlurHandler),this.maxRows!==this.Constant_.NO_MAX_ROWS&&(this.boundKeyDownHandler=this.onKeyDown_.bind(this),this.input_.addEventListener("keydown",this.boundKeyDownHandler)),this.updateClasses_(),this.element_.classList.add(this.CssClasses_.IS_UPGRADED)))},MaterialSelect.prototype.mdlDowngrade_=function(){"use strict";this.input_.removeEventListener("input",this.boundUpdateClassesHandler),this.input_.removeEventListener("focus",this.boundFocusHandler),this.input_.removeEventListener("blur",this.boundBlurHandler),this.boundKeyDownHandler&&this.input_.removeEventListener("keydown",this.boundKeyDownHandler)},componentHandler.register({constructor:MaterialSelect,classAsString:"MaterialSelect",cssClass:"mdl-js-select",widget:!0});