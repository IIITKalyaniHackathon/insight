function dotprd(e,r){for(var t=0,n=0;3>n;n++)t+=e[n]*r[n];return t}function crsprd(e,r){for(var t=new Array(3),n=0;3>n;n++){var i=n+1;i>=3&&(i-=3);var a=n+2;a>=3&&(a-=3),t[n]=e[i]*r[a]-e[a]*r[i]}return t}function triple_prd(e,r,t){return dotprd(crsprd(e,r),t)}function ptdist(e,r){for(var t=0,n=0,i=0;3>i;i++){var a=r[i]-e[i];t+=a*a;var o=r[i]+e[i];n+=o*o}return Math.sqrt(t)-Math.sqrt(n)}function Normalize(e){for(var r=new Array(3),t=0,n=0;3>n;n++){var i=e[n];t+=i*i}for(t>0?nrmult=1/Math.sqrt(t):nrmult=0,n=0;3>n;n++)r[n]=nrmult*e[n];return r}function dotprd_ix(e,r,t){return dotprd(e[r],e[t])}function crsprd_ix(e,r,t){return crsprd(e[r],e[t])}function triple_prd_ix(e,r,t,n){return triple_prd(e[r],e[t],e[n])}function ptdist_ix(e,r,t){return ptdist(e[r],e[t])}function zerovec(){for(var e=new Array(3),r=0;3>r;r++)e[r]=0;return e}function vec_copy(e){for(var r=new Array(3),t=0;3>t;t++)r[t]=e[t];return r}function vec_add_to(e,r){for(var t=0;3>t;t++)e[t]+=r[t]}function vec_mult_scalar_to(e,r){for(var t=0;3>t;t++)e[t]*=r}function vec_difference(e,r){for(var t=zerovec(),n=0;3>n;n++)t[n]=e[n]-r[n];return t}function IsNull(e){return"undefined"==typeof e}function TrianglesEqual(e,r){if(IsNull(e))return!1;if(IsNull(r))return!1;for(var t=0;3>t;t++)if(e.verts[t]!=r.verts[t])return!1;return!0}function EdgesEqual(e,r){if(IsNull(e))return!1;if(IsNull(r))return!1;for(var t=0;2>t;t++)if(e.verts[t]!=r.verts[t])return!1;return!0}function min(e,r){return e>r?r:e}function max(e,r){return r>e?r:e}function TriangleObject(e,r){this.verts=r,this.edges=new Array(3),this.dirs=new Array(3);for(var t=0;3>t;t++){var n=t+1;n>=3&&(n-=3);var i=t+2;i>=3&&(i-=3),this.dirs[t]=crsprd_ix(e,r[n],r[i])}for(this.vol=triple_prd_ix(e,r[0],r[1],r[2]),t=0;3>t;t++)vec_mult_scalar_to(this.dirs[t],1/this.vol);var a=zerovec();for(t=0;3>t;t++)vec_add_to(a,this.dirs[t]);this.ccdir=Normalize(a);var o=0;for(t=0;3>t;t++)o+=ptdist(this.ccdir,e[r[t]]);o/=3,this.ccdsq=o}function EdgeObject(e){this.verts=e,this.polys=new Array(2)}function EdgeCheckObject(e,r){this.verts=r,this.pdst=ptdist_ix(e,r[0],r[1]),this.direc=Normalize(crsprd_ix(e,r[0],r[1]));var t=zerovec();vec_add_to(t,e[r[0]]),vec_add_to(t,e[r[1]]),this.midpnt=Normalize(t)}function AddUnique(e,r){for(var t=0;t<e.length;t++)if(r==e[t])return;e.push(r)}function AddUniqueEdge(e,r){for(var t=0;t<e.length;t++)if(EdgesEqual(e[t],r))return;e.push(r)}function FindShared(e,r){for(var t=[],n=0;n<e.length;n++)for(var i=e[n],a=0;a<r.length;a++){var o=r[a];if(i==o){t.push(i);break}}return t}function FindSharedEdges(e,r){for(var t=[],n=0;n<e.length;n++)for(var i=e[n],a=0;a<r.length;a++){var o=r[a];if(EdgesEqual(i,o)){t.push(i);break}}return t}function FindSetDifference(e,r){if(0!==r.length){for(var t=[],n=0;n<e.length;n++){for(var i=e[n],a=!0,o=0;o<r.length;o++){var s=r[o];if(s==i){a=!1;break}}a&&t.push(i)}e.splice(0,e.length);for(var l=0;l<t.length;l++)e.push(t[l])}}function FindSetDifferenceEdges(e,r){if(0!==r.length){for(var t=[],n=0;n<e.length;n++){for(var i=e[n],a=!0,o=0;o<r.length;o++){var s=r[o];if(EdgesEqual(i,s)){a=!1;break}}a&&t.push(i)}e.splice(0,e.length);for(var l=0;l<t.length;l++)e.push(t[l])}}function TestConsistency(e){for(var r,t,n,i,a,o=!0,s=0;s<e.triangles.length;s++)for(i=e.triangles[s],t=0;3>t;t++){for(r=i.edges[t],a=0,n=0;3>n;n++)r.IsVertex(i.verts[n])&&a++;2!=a&&(o=!1),r.PolyIndexIn(i)<0&&(o=!1)}for(s=0;s<e.edges.length;s++){r=e.edges[s];var l=0;for(t=0;2>t;t++)if(i=r.polys[t],IsNull(i))l++;else{for(a=0,n=0;2>n;n++)i.IsVertex(r.verts[n])&&a++;2!=a&&(o=!1),i.EdgeIndexIn(r)<0&&(o=!1)}l>1&&(o=!1)}return o}function AddPointInside(e,r){for(var t,n=e.positions,i=n[r],a=e.triangles.length,o=0;a>o;o++){var s=e.triangles[o];if(s.IsPointInside(i)){for(var l=s.edges,c=[],u=0;3>u;u++)c.push(l[u].PolyIndexIn(s));var d=Array(3),f=Array(3);for(u=0;3>u;u++)t=u+1,t>=3&&(t-=3),d[u]=new TriangleObject(n,[s.verts[u],s.verts[t],r]),f[u]=new EdgeObject([s.verts[u],r]);for(u=0;3>u;u++)t=u+1,t>=3&&(t-=3),d[u].edges[0]=f[t],d[u].edges[1]=f[u],f[u].polys[0]=d[u],f[t].polys[1]=d[u];for(u=0;3>u;u++)for(var g=l[u],h=c[u],p=0;3>p;p++){var v=d[p];numverts=0;for(var y=0;2>y;y++)if(v.IsVertex(g.verts[y])&&numverts++,2==numverts){g.polys[h]=v,v.edges[2]=g;break}}for(e.triangles[o]=d[0],u=1;3>u;u++)e.triangles.push(d[u]);for(u=0;3>u;u++)e.edges.push(f[u]);return!0}}return!1}function ImproveTriangulation(e){for(var r,t=e.positions,n=new Array(4),i=0;100>i;i++){for(var a=0,o=0;o<e.edges.length;o++){var s=e.edges[o],l=s.polys;if(!IsNull(l[0])&&!IsNull(l[1])){for(d=0;3>d&&(r=l[0].verts[d],s.IsVertex(r));d++);var c=d+1;c>=3&&(c-=3);var u=d+2;u>=3&&(u-=3),n[0]=r,n[1]=l[0].verts[c],n[3]=l[0].verts[u];for(var d=0;3>d&&(r=l[1].verts[d],s.IsVertex(r));d++);n[2]=r;var f=l[0].IsPointInCircumcircle(t[n[2]]),g=l[1].IsPointInCircumcircle(t[n[0]]);if(f||g){var h=new TriangleObject(t,[n[0],n[1],n[2]]);if(h.IsVertexOrderCorrect()){var p=new TriangleObject(t,[n[0],n[2],n[3]]);if(p.IsVertexOrderCorrect()){a++;var v,y,m,b,w;for(d=0;3>d;d++)if(v=l[0].edges[d],!EdgesEqual(v,s)&&v.IsVertex(n[3])){y=v,b=d;break}for(d=0;3>d;d++)if(v=l[1].edges[d],!EdgesEqual(v,s)&&v.IsVertex(n[1])){m=v,w=d;break}var _=y.PolyIndexIn(l[0]),k=m.PolyIndexIn(l[1]);y.polys[_]=l[1],m.polys[k]=l[0],l[0].edges[b]=m,l[1].edges[w]=y,l[0].copy_vert_info(h),l[1].copy_vert_info(p),s.verts=[n[0],n[2]]}}}}}if(0===a)break}}function FindConvexHull(e){for(var r,t=(e.positions,{}),n=-1,i=0;i<e.edges.length;i++){var a=e.edges[i];if(IsNull(a.polys[0])){if(IsNull(a.polys[1]))continue;r=a.polys[1]}else{if(!IsNull(a.polys[1]))continue;r=a.polys[0]}var o=a.verts[0],s=a.verts[1],l=r.VertexIndexIn(s)-r.VertexIndexIn(o);if(0>l&&(l+=3),1!=l){var c=o;o=s,s=c}t[o]=s,n=o}if(n>=0){for(var u=n,d=[u];;){var f=t[u];if(f==n)break;d.push(f),u=f}e.hull=d}}function FindVoronoiDiagram(e){var r,t,n,i,a,o,s,l,c,u,d,f,g,h,p,v,y,m,b,w,_,k,x;if(1!=e.triangles.length){if(0!==e.triangles.length){for(j=0;j<e.triangles.length;j++)l=e.triangles[j],l.index=j,e.vor_positions.push(l.ccdir);for(var j=0;j<e.edges.length;j++)if(r=e.edges[j],!IsNull(r.polys[0])&&!IsNull(r.polys[1])){var E=[r.polys[0].index,r.polys[1].index];e.vor_edges.push(E)}for(j=0;j<e.indices.length;j++)o=e.indices[j],e.vor_polygons[o]={},s=e.vor_polygons[o],s.edges=[],s.triangles=[],s.boundary=[];for(j=0;j<e.edges.length;j++)for(r=e.edges[j],c=0;2>c;c++)e.vor_polygons[r.verts[c]].edges.push(r);for(j=0;j<e.triangles.length;j++)for(l=e.triangles[j],c=0;3>c;c++)e.vor_polygons[l.verts[c]].triangles.push(l);for(j=0;j<e.indices.length;j++){o=e.indices[j],s=e.vor_polygons[o];var O=s.triangles[0];for(l=O,s.boundary.push(l.index),c=0;3>c&&(r=l.edges[c],!r.IsVertex(o));c++);for(var T=r,M=!1;;){if(u=r.PolyIndexIn(l),l=r.polys[1-u],IsNull(l))break;if(TrianglesEqual(l,O)){M=!0;break}for(s.boundary.push(l.index),c=0;3>c;c++)if(d=l.edges[c],!EdgesEqual(d,r)&&d.IsVertex(o)){r=d;break}}if(!M){for(s.boundary.reverse(),l=O,c=0;3>c&&(r=l.edges[c],EdgesEqual(r,T)||!r.IsVertex(o));c++);for(;;){if(u=r.PolyIndexIn(l),l=r.polys[1-u],IsNull(l))break;for(s.boundary.push(l.index),c=0;3>c;c++)if(d=l.edges[c],!EdgesEqual(d,r)&&d.IsVertex(o)){r=d;break}}}M||(s.boundary.reverse(),s.boundary.push(-1),s.boundary.reverse(),s.boundary.push(-1))}if(e.hull.length>=3){var I=[],C=e.positions,L=e.hull.length;for(c=0;L>c;c++){o=e.hull[c];var q=c+1;q>=L&&(q=0);var N=e.hull[q],A=e.vor_polygons[o].edges,z=e.vor_polygons[N].edges,P=FindSharedEdges(A,z);r=P[0];var F=r.polys[0].index;f=C[o],g=C[N],b=vec_difference(g,f),k=[F,e.vor_positions[F],o,f,N,g,b],I.push(k)}for(;I.length>3;){var V=I.length,G=[],S=[];for(a=0;V>a;a++)S.push([]);for(a=0;V>a;a++)h=a+1,h>=V&&(h=0),m=Normalize(crsprd(I[a][6],I[h][6])),vec_mult_scalar_to(m,-1),S[a].push(G.length),S[h].push(G.length),G.push(m);for(a=0;V>a;a++){if(y=S[a],y.length>=2){for(var D=[],Q=0;Q<y.length;Q++)D.push(ptdist(G[y[Q]],I[a][1]));for(var H=0,B=D[H],$=0;$<D.length;$++){var U=D[$];B>U&&(H=$,B=U)}v=y[H]}else v=1==y.length?y[0]:-1;S[a]=v}var W=[];for(a=0;V>a;a++){h=a+1,h>=V&&(h=0),p=a-1,0>p&&(p=V-1);var R=0;if(y=S[a],-1!=y){var Y=S[p];y==Y?R=2:(ptitsc_next=S[h],y==ptitsc_next&&(R=1))}if(0===R)W.push(I[a]);else if(1==R){var X=I[a],J=I[h];m=G[a];var Z=X[0],K=J[0],ee=K!=Z;if(ee){w=e.vor_positions.length,_=X[2],f=X[3],ix1=J[4],g=J[5];for(var re,te,ne=0;V>ne;ne++){for(var ie=ptdist(I[ne][3],m),ae=ne-a;0>ae;)ae+=V;for(;ae>=V;)ae-=V;2>=ae?void 0===re?re=ie:re>ie&&(re=ie):void 0===te?te=ie:te>ie&&(te=ie)}ee=te>re}if(ee){b=vec_difference(g,f),k=[w,m,_,f,ix1,g,b],W.push(k),e.vor_positions.push(m);var oe=X[4];e.vor_edges.push([Z,w]),e.vor_edges.push([K,w]),e.vor_polygons[oe].boundary.shift(),x=e.vor_polygons[oe].boundary.length,e.vor_polygons[oe].boundary[x-1]=w,e.vor_polygons[_].boundary[1]==Z?(e.vor_polygons[_].boundary.unshift(-1),e.vor_polygons[_].boundary[1]=w):(x=e.vor_polygons[_].boundary.length,e.vor_polygons[_].boundary[x-2]==Z&&(e.vor_polygons[_].boundary.push(-1),x=e.vor_polygons[_].boundary.length,e.vor_polygons[_].boundary[x-2]=w)),e.vor_polygons[ix1].boundary[1]==K?(e.vor_polygons[ix1].boundary.unshift(-1),e.vor_polygons[ix1].boundary[1]=w):(x=e.vor_polygons[ix1].boundary.length,e.vor_polygons[ix1].boundary[x-2]==K&&(e.vor_polygons[ix1].boundary.push(-1),x=e.vor_polygons[ix1].boundary.length,e.vor_polygons[ix1].boundary[x-2]=w))}else W.push(X),W.push(J)}}if(W.length==I.length)break;I=W}if(2==I.length){if(I[0][0]!=I[1][0]){var se=[];for(a=0;2>a;a++)h=I[a][0],se.push(h),h=I[a][2],e.vor_polygons[h].boundary.shift(),e.vor_polygons[h].boundary.pop();e.vor_edges.push(se)}}else if(3==I.length){var le=I[0][0],ce=I[1][0],ue=I[2][0];if(le!=ce&&le!=ue&&ce!=ue)for(w=e.vor_positions.length,t=I[0][3],n=I[1][3],i=I[2][3],m=zerovec(),vec_add_to(m,crsprd(t,n)),vec_add_to(m,crsprd(n,i)),vec_add_to(m,crsprd(i,t)),m=Normalize(m),vec_mult_scalar_to(m,-1),e.vor_positions.push(m),a=0;3>a;a++)k=I[a],e.vor_edges.push([k[0],w]),o=k[2],e.vor_polygons[o].boundary.shift(),x=e.vor_polygons[o].boundary.length,e.vor_polygons[o].boundary[x-1]=w}}for(a=0;a<e.vor_polygons.length;a++)s=e.vor_polygons[a],s.boundary.length>=3&&s.boundary[0]>=0&&(l=new TriangleObject(e.vor_positions,s.boundary.slice(0,3)),l.IsVertexOrderCorrect()||s.boundary.reverse())}else if(2==e.hull.length){t=e.positions[e.hull[0]],n=e.positions[e.hull[1]],f=zerovec(),vec_add_to(f,t),vec_add_to(f,n),f=Normalize(f),e.vor_positions.push(f),g=Normalize(crsprd(t,n)),e.vor_positions.push(g),vt2=vec_copy(f),vec_mult_scalar_to(vt2,-1),e.vor_positions.push(vt2);var de=vec_copy(g);for(vec_mult_scalar_to(de,-1),e.vor_positions.push(de),e.vor_edges.push([0,1,2,3,0]),r=e.edges[0],a=0;2>a;a++)o=e.hull[a],e.vor_polygons[o]={},s=e.vor_polygons[o],s.edges=[r],s.triangles=[0],0===a?s.boundary=[0,1,2,3]:1==a&&(s.boundary=[0,3,2,1])}}else if(3==e.hull.length){for(l=e.triangles[0],e.vor_positions.push(l.ccdir),a=0;3>a;a++){h=a+1,h>=3&&(h=0),p=a-1,0>p&&(p=2),n=e.positions[e.hull[a]],i=e.positions[e.hull[h]];var fe=vec_difference(i,n);e.vor_positions.push(Normalize(crsprd(fe,l.ccdir))),e.vor_edges.push([0,a+1,4]),o=e.hull[a],e.vor_polygons[o]={},s=e.vor_polygons[o];for(var ge=e.hull[p],he=0;3>he;he++){r=e.edges[he];var pe=FindShared([ge,o],r.verts);if(2==pe.length)break}s.edges=[r],s.triangles=[l],s.boundary=[0,p+1,4,a+1]}var ve=vec_copy(l.ccdir);vec_mult_scalar_to(ve,-1),e.vor_positions.push(ve)}}function FindDelaunayTriangulationIndexed(e,r){var t,n,i,a,o={};if(o.positions=e,o.indices=r,o.triangles=[],o.edges=[],o.hull=[],o.vor_positions=[],o.vor_edges=[],o.vor_polygons={},r.length<3)return 2==r.length&&(o.edges.push(new EdgeObject(r)),o.hull=r),FindVoronoiDiagram(o),o;var s=new TriangleObject(e,r.slice(0,3));s.IsVertexOrderCorrect()||(s=new TriangleObject(e,[r[0],r[2],r[1]])),o.triangles.push(s);for(var l=new Array(3),c=0;3>c;c++){t=c+1,t>=3&&(t-=3),v=r[c],n=r[t];var u=[v,n];i=new EdgeObject(u);var d=new EdgeCheckObject(e,u);d.edge=i,l[c]=d,s.edges[c]=i,i.polys[0]=s,o.edges.push(i)}var f=r.slice(0,3),g=l,h=Object;for(c=0;3>c;c++)t=c+2,t>=3&&(t-=3),v=r[c],h[v]=[l[c],l[c+1]];for(var p=3;p<r.length;p++){var v=r[p];if(!AddPointInside(o,v)){h[v]=[];for(var y=[],m=[],b=[],w=0;w<f.length;w++){n=f[w],a=new EdgeCheckObject(e,[v,n]);for(var _=!1,k=0;k<g.length;k++){var x=g[k];if(_=a.intersects(e,x))break}_||(i=new EdgeObject(a.verts),a.edge=i,AddUniqueEdge(y,a),AddUniqueEdge(h[v],a),AddUnique(m,v),AddUniqueEdge(h[n],a),AddUnique(m,n))}for(AddUnique(f,v),w=0;w<g.length;w++){a=g[w];for(var j=[],E=0;2>E;E++){var O=FindSharedEdges(h[v],h[a.verts[E]]);0!==O.length&&j.push(O[0])}if(!(j.length<2)){var T=-1;for(E=0;2>E;E++)if(IsNull(a.edge.polys[E])){T=E;break}if(!(0>T)){var M,I=a.edge.polys[1-T],C=a.verts[0],L=I.VertexIndexIn(C),q=a.verts[1],N=I.VertexIndexIn(q),A=N-L;if(0>A&&(A+=3),1==A?M=[v,q,C]:2==A&&(M=[v,C,q]),s=new TriangleObject(e,M),s.IsVertexOrderCorrect())for(o.triangles.push(s),a.edge.polys[T]=s,s.edges[0]=a.edge,s.edges[1]=j[0].edge,s.edges[2]=j[1].edge,AddUniqueEdge(b,a),E=0;2>E;E++){var z=j[E];IsNull(z.edge.polys[0])?(z.edge.polys[0]=s,o.edges.push(z.edge)):(z.edge.polys[1]=s,AddUniqueEdge(b,z))}}}}for(w=0;w<y.length;w++)AddUniqueEdge(g,y[w]);FindSetDifferenceEdges(g,b);var P=[];for(w=0;w<m.length;w++){var F=m[w];FindSetDifferenceEdges(h[F],b),0===h[F].length&&P.push(F)}FindSetDifference(f,P)}}return ImproveTriangulation(o),FindConvexHull(o),FindVoronoiDiagram(o),o}function FindDelaunayTriangulation(e){for(var r=new Array(e.length),t=0;t<r.length;t++)r[t]=t;return FindDelaunayTriangulationIndexed(e,r)}var niclabs={};niclabs.insight=function(e){"use strict";Array.prototype.forEach||(Array.prototype.forEach=function(e,r){var t,n;if(null===this)throw new TypeError(" this is null or not defined");var i=Object(this),a=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(t=r),n=0;a>n;){var o;n in i&&(o=i[n],e.call(t,o,n,i)),n++}}),e.fn.template=function(r){"undefined"==typeof r?r=this.html():"string"==typeof r&&"#"===r.charAt(0)&&(r=e(r).html());var t=this;return this.bind("render",function(n,i){t.empty().append(r),t.find("[data-bind],[data-if]").each(function(){var r=e(this).attr("data-bind")||e(this).attr("data-if"),t=e(this).prop("tagName");r in i?e(this).attr("data-bind")&&("img"===t?e(this).attr("src",i[r]):"input"===t?e(this).val(i[r]):e(this).text(i[r])):e(this).detach()})}),this},e.fn.resizable=function(r){function t(r){o=r.clientX,s=r.clientY,l=h.outerWidth(),c=h.outerHeight(),e(document).on("mousemove",n),e(document).on("mouseup",i)}function n(e){d&&h.css("height",c+e.clientY-s+"px"),u&&h.css("width",l+e.clientX-o+"px"),f&&h.css("top",e.clientY+"px").css("height",c+s-e.clientY+"px"),g&&h.css("width",l-e.clientX+o+"px")}function i(r){e(document).off("mousemove",n),e(document).off("mouseup",i),h.trigger("resize")}var a=e("<div>").addClass("resizer").addClass(r+"-resize");this.append(a).addClass("resizable"),a.on("mousedown",t);var o,s,l,c,u,d,f,g,h=this;return d=r.search("s")>=0,u=r.search("e")>=0,f=r.search("n")>=0,g=r.search("w")>=0,this.scroll(function(e){a.css("top",h.scrollTop())}),this},e.fn.setID=function(e){return"#"===e.charAt(0)&&(e=e.slice(1)),this.attr("id",e),this},e.fn.movable=function(){var r=this.children(".header");0===r.length&&(r=e("<div>").addClass("header"),this.prepend(r));var t=e("<span>").addClass("button").attr("data-icon","up-arrow"),n=e("<span>").addClass("button").attr("data-icon","down-arrow");r.append(t),r.append(n);var i=this;return t.on("click",function(){i.insertBefore(i.prev())}),n.on("click",function(){i.insertAfter(i.next())}),this},e.fn.closable=function(r){r||(r=function(){});var t=this.children(".header");t.length||(t=e("<span>").addClass("header"),this.prepend(t));var n=e("<span>").addClass("button").attr("data-icon","close");t.prepend(n);var i=this;return n.on("click",function(){i.remove(),r()}),this},e.fn.hidable=function(){var t=!1;t||(t=function(){map=r.map().googlemap(),google.maps.event.trigger(map,"resize")});var n=this.children(".header").css("height","25px");n.length||(n=e("<div>").css("height","25px"),this.prepend(n));var i=e("<div>").addClass("button").attr("data-icon","hide"),a=e("<div>").addClass("button").attr("data-icon","show"),o=e(".resizer");n.prepend(i);var s,l,c=this,u=function(){for(var r=0;r<s.length;r++)e("#insight-info-view").append(s[r]);e("#insight-info-view").removeClass("hidden").addClass("info resizable"),e("#insight-info-view").append(o),e("#insight-info-view").css("width",l),n.prepend(i),a.remove(),t(),i.on("click",d),l=void 0},d=function(){s||(s=c.find(".block")),l||(l=e("#insight-info-view").css("width"));for(var r=0;r<s.length;r++)s[r].remove();e("#insight-info-view").removeClass("info resizable").removeAttr("style").addClass("hidden"),n.prepend(a),i.remove(),t(),a.on("click",u)};return a.on("click",u),i.on("click",d),this},Array.prototype.indexOf="indexOf"in Array.prototype?Array.prototype.indexOf:function(r,t){return e.inArray(r,this,t)},Object.size=function(e){var r,t=0;for(r in e)e.hasOwnProperty(r)&&t++;return t},Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(e,r){var t=this[e],n=function(){return t},i=function(n){return t===n?!1:(r.call(this,e,t,n),void(t=n))};delete this[e]&&Object.defineProperty(this,e,{get:n,set:i,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(e){var r=this[e];delete this[e],this[e]=r}}),Object.prototype.spy||Object.defineProperty(Object.prototype,"spy",{enumerable:!1,configurable:!0,writable:!1,value:function(e){for(var r in this)this.hasOwnProperty(r)&&this.watch(r,e)}}),Object.prototype.unspy||Object.defineProperty(Object.prototype,"unspy",{enumerable:!1,configurable:!0,writable:!1,value:function(){for(var e in this)this.hasOwnProperty(e)&&this.unwatch(e)}});var r,t={};return{handler:function(e,r,n){if(e in t){if(r="undefined"==typeof r?t[e].kind:r,n="undefined"==typeof n?t[e].handler:n,r!==t[e].kind)throw new Error("There already exists a handler with name "+e+" for kind "+t[e].kind)}else if("undefined"==typeof r&&"undefined"==typeof n)throw new Error("Handler "+e+" does not exist");return t[e]={kind:r,handler:n},n},dashboard:function(e){return"undefined"==typeof e?r:r=niclabs.insight.Dashboard(e)}}}(jQuery),niclabs.insight.Color=function(){function e(e,r,t){e/=255,r/=255,t/=255;var n,i,a=Math.max(e,r,t),o=Math.min(e,r,t),s=a,l=a-o;if(i=0===a?0:l/a,a==o)n=0;else{switch(a){case e:n=(r-t)/l+(t>r?6:0);break;case r:n=(t-e)/l+2;break;case t:n=(e-r)/l+4}n/=6}return[n,i,s]}function r(e,r,t){var n,i,a,o=Math.floor(6*e),s=6*e-o,l=t*(1-r),c=t*(1-s*r),u=t*(1-(1-s)*r);switch(o%6){case 0:n=t,i=u,a=l;break;case 1:n=c,i=t,a=l;break;case 2:n=l,i=t,a=u;break;case 3:n=l,i=c,a=t;break;case 4:n=u,i=l,a=t;break;case 5:n=t,i=l,a=c}return[255*n,255*i,255*a]}function t(e){e=Math.floor(e);var r=e.toString(16);return 1==r.length?"0"+r:r}function n(e){return"#"+t(e[0])+t(e[1])+t(e[2])}function i(e){var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return r?[parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16)]:null}return{rgbToHsv:e,hsvToRgb:r,rgbToHex:n,hexToRgb:i}}(),niclabs.insight.Dashboard=function(e){"use strict";return function(r){function t(e){return e="undefined"==typeof e?u++:e,"layer"+e}var n=["left","right","none"],i="#insight-dashboard";if(!("anchor"in r))throw new Error("Anchor id is required for creating a dashboard");var a=r.anchor;if(r.layout=r.layout||"none",n.indexOf(r.layout)<0)throw new Error("Layout must be one of '"+n.join("','")+"'");var o=e("<div>"),s=e("<div>").setID(i).addClass("mdl-grid");e(o).append(s),e(a).append(o);var l,c={},u=0,d={},f={};niclabs.insight.event.on("layer_data",function(e){l&&e.id===l.id&&niclabs.insight.event.trigger("active_layer_data",e)});var g=niclabs.insight.Filters(p),h=function(){return!0};niclabs.insight.event.on("filter_changed",function(e){h=e,l.filter(h)});var p={get element(){return e(i)[0]},get $(){return e(i)},config:function(e){return r[e]},info:function(t){return"undefined"!=typeof t&&(d="handler"in t?niclabs.insight.handler(t.handler)(p,t):t,e(i).append(e("<div>").addClass("mdl-cell mdl-cell--4-col-phone mdl-cell--9-col-desktop")),"left"==r.layout&&e(i).prepend(d.element),"right"==r.layout&&e(i).append(d.element)),d},layout:function(){return r.layout},map:function(t){return"undefined"!=typeof t&&(f="handler"in t?niclabs.insight.handler(t.handler)(p,t):t,e(i).prepend(f.element),e(f.element).width(e(i).width()).height(e("body").height()),r.geocoding!==!1&&"googlemap"in f&&g.filter(niclabs.insight.filter.GoogleGeocodingFilter(p,{id:"geocoder"}))),f},layer:function(e,r){if("string"==typeof e)return c[e];if("number"==typeof e)return c[t(e)];var n,i;return"handler"in e?(i=e.id=e.id||t(),n=niclabs.insight.handler(e.handler)(p,e)):(n=e,i=n.id),c[i]=n,(r||1===Object.size(c))&&p.active(i),v.add(n.id,n.name),n},data:function(e){return l?l.data(e):[]},active:function(e){if("undefined"==typeof e)return"undefined"!=typeof l?l.id:void 0;if("undefined"!=typeof l&&l.clear(),"number"==typeof e&&(e=t(e)),!(e in c))throw new Error("Layer with id "+e+" does not exist");return l=c[e],l.load(),l.filter(h),l},filter:function(e){return g.filter(e)},clear:function(){l&&l.clear()}},v=niclabs.insight.filter.LayerSelector(p,{id:"layer-selector"});return g.filter(v),p}}(jQuery),niclabs.insight.ElementList=function(){var e=function(e){function r(e){return e="undefined"==typeof e?i++:e,"__"+e}var t={},n={},i=0;return t.element=function(t){if("string"==typeof t)return n[t];if("number"==typeof t)return n[r(t)];var i,a;return"handler"in t?(a=t.id=t.id||r(),i=niclabs.insight.handler(t.handler)(e,t)):(i=t,a=i.id),n[a]=i,i},t.each=function(e){for(var r in n)if(e(r,n[r])===!1)return!1},t.remove=function(e){if("number"==typeof obj&&(e=r(e)),e in n){var t=n[e];return delete n[e],t}},t};return e}(),niclabs.insight.Element=function(e){var r=function(e){if(!("id"in e))throw Error("All UI elements must define an identifier");var r=e.id;if(!/^[^#. '"]+$/.test(r))throw Error("The UI element id must be at least 1 character long and cannot contain the following characters ['#','.',' ', ''', '\"'])");return{get id(){return r}}};return r}(jQuery),niclabs.insight.Filters=function(e){"use strict";return function(e,r){function t(e){var r=!0;return a.each(function(t,n){return n.apply(e)?void 0:(r=!1,!1)}),r}r=r||{};var n=r.id||"insight-filters",i=niclabs.insight.View({id:n});i.$.addClass("filters");var a=niclabs.insight.ElementList(e);return niclabs.insight.event.on("filter_selected",function(e){niclabs.insight.event.trigger("filter_changed",t)}),i.filter=function(e){var r=a.element(e);return i.append(r),r},i}}(jQuery),niclabs.insight.InfoView=function(e){"use strict";var r=function(e,r){r=r||{};var t=r.id||"insight-info-view",n=niclabs.insight.View({id:t});n.$.addClass("mdl-cell mdl-cell--4-col-phone mdl-cell--3-col-desktop");var i;"none"!==e.config("layout")&&("left"===e.config("layout")?i="e":"right"===e.config("layout")&&(i="w"));var a=niclabs.insight.ElementList(e);n.block=function(e){var r=a.element(e);return n.$.append(r.element),r};var o;if(r.blocks)for(o=0;o<r.blocks.length;o++)n.block(r.blocks[o]);return n.$.on("resize",function(e){a.each(function(e,r){r.refresh()})}),niclabs.insight.event.on("remove-block",function(e){a.remove(e.id)}),n};return niclabs.insight.handler("basic-info-view","info-view",r),r}(jQuery),niclabs.insight.Interpolation=function(){function e(e,r,t,n){return t+(n-t)*e/r}function r(r,t,n,i){var a=e(r,t,n[0],i[0]),o=e(r,t,n[1],i[1]),s=e(r,t,n[2],i[2]);return[a,o,s]}function t(e,t,n,i){var a=niclabs.insight.Color.rgbToHsv(n[0],n[1],n[2]),o=niclabs.insight.Color.rgbToHsv(i[0],i[1],i[2]),s=r(e,t,a,o);return niclabs.insight.Color.hsvToRgb(s[0],s[1],s[2])}return{interpolate:e,interpolate3d:r,interpolateRgb:t}}(),niclabs.insight.MapView=function(e){"use strict";return function(r){var t="#insight-map-view",n={lat:r.lat||0,lng:r.lng||0},i=r.zoom||12,a=e("<div>").setID(t).addClass("map"),o={get element(){var r=e(t);return a=0===r.length?a:r,a[0]},get $(){var r=e(t);return a=0===r.length?a:r},center:function(e,r){return n.lat=e="undefined"==typeof e?n.lat:e,n.lng=r="undefined"==typeof r?n.lng:r,n},get lat(){return n.lat},get lng(){return n.lng},get width(){return o.$.width()},get height(){return o.$.height()},zoom:function(e){return i=e="undefined"==typeof e?i:e}};return o}}(jQuery),niclabs.insight.View=function(e){var r=function(r){var t=niclabs.insight.Element(r),n=e("<div>").attr("id",t.id);return Object.defineProperty(t,"$",{get:function(){var r=e("#"+t.id);return n=0===r.length?n:r}}),Object.defineProperty(t,"element",{get:function(){return t.$[0]}}),t.append=function(e){return t.$.append(e.$),t},t};return r}(jQuery),niclabs.insight.event=function(){"use strict";function e(e,t){if(e in r)for(var n=0;n<r[e].length;n++)if(r[e][n]===t)return n;return-1}var r={};return{on:function(t,n){var i=e(t,n);return 0>i?(t in r||(r[t]=[]),r[t].push(n)-1):i},off:function(t,n){var i="number"==typeof n?n:e(t,n);return i>=0?(r[t].splice(i,1),!0):!1},trigger:function(e,t){if(e in r)for(var n=0;n<r[e].length;n++)r[e][n](t)}}}(),niclabs.insight.filter={},niclabs.insight.filter.Filter=function(){var e=function(e,r){var t=niclabs.insight.View(r);return t.$.addClass("filter"),t.apply=function(e){return!0},t};return e}(),niclabs.insight.filter.GoogleGeocodingFilter=function(e){var r=function(r,t){var n=niclabs.insight.filter.Filter(r,t);if(!("googlemap"in r.map()))throw new Error("Sorry, Google Geocoding can only be used with Google Maps");var i=new e.maps.Geocoder,a=$("<input>").addClass("search").attr("type","search").attr("placeholder","Enter location");n.$.append(a);var o=function(){var t=r.map().googlemap(),n=a.val();i.geocode({address:n},function(r,i){i==e.maps.GeocoderStatus.OK?(t.setCenter(r[0].geometry.location),t.fitBounds(r[0].geometry.bounds)):a.val("not found: "+n)})};return a.on("change",o),n};return niclabs.insight.handler("google-geocoder","filter",r),r}(google),niclabs.insight.filter.LayerSelector=function(e){var r=function(r,t){var n=niclabs.insight.filter.Filter(r,t),i={},a=e("<select>");return a.hide(),a.on("change",function(){r.active(e(this).val())}),n.$.append(a),n.add=function(r,t){i[r]=t,a.append(e("<option>").attr("value",r).text(t)),Object.keys(i).length>1&&a.show()},n};return niclabs.insight.handler("layer-selector","filter",r),r}(jQuery),niclabs.insight.filter.SelectionFilter=function(e){var r=function(r,t){function n(e){return!0}var i=niclabs.insight.filter.Filter(r,t),a=t.options||[],o=e("<select>");o.append(e("<option>").text(t.description||"")),a.forEach(function(r){o.append(e("<option>").text(r.name))});var s=n;return o.on("change",function(){s=n;var r=e(this).prop("selectedIndex");r>0&&(s=a[r-1].filter),niclabs.insight.event.trigger("filter_selected",i)}),i.$.append(o),i.apply=function(e){return s(e)},i};return niclabs.insight.handler("selection-filter","filter",r),r}(jQuery),niclabs.insight.info=function(){var e=function(e){var r=niclabs.insight.dashboard();if("undefined"==typeof r)throw new Error("Dashboard has not been initialized");return r.info(e)};return e}(),niclabs.insight.info.Block=function(e){"use strict";var r=function(r,t){function n(){niclabs.insight.event.trigger("remove-block",{id:o})}function i(e,r){h=niclabs.insight.event.on("map_element_selected",function(t){r&&t.layer!==r||e.refresh(e.__data__(t))}),p=niclabs.insight.event.on("layer_summary",function(t){r&&t.id!==r||e.refresh(e.__data__(t.data))})}function a(e){niclabs.insight.event.off("map_element_selected",h),niclabs.insight.event.off("layer_summary",p)}if(!("id"in t))throw new Error("All information blocks must have an id");var o=t.id,s="#"===o.charAt(0)?o:"#"+o,l=t.title||"",c={closable:"undefined"==typeof t.closable?!0:t.closable,movable:"undefined"==typeof t.movable?!0:t.movable},u=t.preprocess||function(e){return e},d=e("<div>").addClass("header").append(e("<span>").attr("data-bind","title").addClass("title").append(l)),f=e("<div>").setID(s).addClass("mdl-card").addClass("mdl-shadow--2dp").append(d);"right"==r.layout()&&f.addClass("right");var g=e("<div>").addClass("content");f.append(g),c.closable&&f.closable(function(){n()}),c.movable&&f.movable(),f.css(c);var h,p,v,y={},m={get id(){return o},get element(){var r=e(s);return f=0===r.length?f:r,f[0]},get $(){var r=e(s);return f=0===r.length?f:r},get layer(){return v},get content(){var r=e(s).find(".content");return g=0===r.length?g:r},title:function(e){return"undefined"!=typeof e&&(l=e,m.$.find(".title").text(e)),l},__data__:function(e){return"undefined"==typeof e?y:y=0===Object.keys(e).length?{}:u(e)},remove:n,data:function(r){return"undefined"==typeof r?y:(v=void 0,a(m),"string"==typeof r?"#"===r.charAt(0)?(v=r.substring(1),y=t.defaults||{},i(m,v),y):(e.getJSON(r,m.__data__),r):"function"==typeof r?m.__data__(r.call(m)):m.__data__(r))},refresh:function(e){}};return"data"in t?m.data(t.data):(i(m),y=t.defaults||{}),m};return r}(jQuery),niclabs.insight.info.ChartistBlock=function(e){var r=function(r,t,n){var i=niclabs.insight.info.Block(r,n),a=n.chartist;i.content.addClass("chartist-viz").append(e("<div>").addClass(a["class"]));var o,s=a.options||{},l=a.responsiveOptions||{},c=a.labels,u=i.refresh;i.refresh=function(e){e="undefined"==typeof e?i.data():e,u(e),e=e.value||e;var r={series:e,labels:"function"==typeof c?c(e):c};o&&o.optionsProvider?o.update(r):o=new t(i.content.find("div")[0],r,s,l)};var d=i.remove;return i.remove=function(){d(),o.detach()},i.refresh(),i},t=function(e,t){var n=r(e,Chartist.Line,t);return n},n=function(e,t){var n=r(e,Chartist.Bar,t);return n},i=function(e,t){var n=r(e,Chartist.Pie,t);return n};return niclabs.insight.handler("chartist-linechart","info-block",t),niclabs.insight.handler("chartist-barchart","info-block",n),niclabs.insight.handler("chartist-piechart","info-block",i),r}(jQuery),niclabs.insight.info.SummaryBlock=function(e){var r=function(e,r){var t=niclabs.insight.info.Block(e,r),n=r.template||'        <h6 class="mdl-card__title-text" data-if="lat">             lat: <span data-bind="lat"> -- </span>             lng: <span data-bind="lng"> -- </span>         </h6>        <dl class="deflist mdl-card__supporting-text">            <dt class="deflist-key" data-if="description">description</dt>             <dd class="deflist-value" data-bind="description">none</dd>             <dt class="deflist-key" data-if="landmark">landmark</dt>             <dd class="deflist-value" data-bind="landmark">none</dd>             <dt class="deflist-key" data-if="fun-fact">fun-fact</dt>             <dd class="deflist-value" data-bind="fun-fact">none</dd>         </dl>        ';t.content.template(n);var i=t.refresh;return t.refresh=function(e){e="undefined"!=typeof e?e:t.data(),i(e),t.content.trigger("render",e)},t.refresh(),t};return niclabs.insight.handler("summary-block","info-block",r),r}(jQuery),niclabs.insight.layer=function(){var e=function(e,r){var t=niclabs.insight.dashboard();if("undefined"==typeof t)throw new Error("Dashboard has not been initialized");return t.layer(e,r)};return e}(),niclabs.insight.layer.DiagramLayer=function(e){var r=function(r,t){function n(t,n){var i;if("type"in n){var o={layer:a.id,data:t};e.extend(o,n),i=niclabs.insight.handler(n.type)(r,o)}else i=n;return i}var i,a=niclabs.insight.layer.Layer(r,t),o=t.diagram||{type:"voronoi-diagram"};return a.draw=function(e){i=n(e,o)},a.clear=function(){i&&i.clear()},a.filter=function(e){},a};return niclabs.insight.handler("diagram-layer","layer",r),r}(jQuery),niclabs.insight.layer.GraphLayer=function(e){var r=function(r,t){function n(t,n,i){var o;if("type"in i){var s={layer:a.id};e.extend(s,i,t[n]),o=niclabs.insight.handler("node")(r,s)}else o=i;return o.clickable(!0),o}function i(t,n,i,o){var s;if("type"in o){var l={layer:a.id};e.extend(l,o,{startNode:t[n],endNode:t[i]}),s=niclabs.insight.handler("edge")(r,l)}else s=o;return s.clickable(!0),s}var a=niclabs.insight.layer.Layer(r,t),o=t.graph||{type:"simple-graph"},s=[],l=[];return a.draw=function(e){
for(var r=0;r<e.length;r++)s.push(n(e,r,o));for(r=0;r<o.adj.length;r++)for(var t=0;r>t;t++)1==o.adj[r][t]&&l.push(i(e,r,t,o))},a.clear=function(){for(var e=0;e<s.length;e++)s[e].clear();for(s=[],e=0;e<l.length;e++)l[e].clear();l=[]},a.filter=function(e){},a};return niclabs.insight.handler("graph-layer","layer",r),r}(jQuery),niclabs.insight.layer.GridLayer=function(){var e=function(e,r){function t(r,t){var n;if("type"in t){var a={layer:i.id,data:r};$.extend(a,t),n=niclabs.insight.handler(t.type)(e,a)}else n=t;return n}var n,i=niclabs.insight.layer.Layer(e,r),a=r.grid||{type:"hexagon"};return i.draw=function(e){n=t(e,a)},i.clear=function(){n&&n.clear()},i.filter=function(e){},i};return niclabs.insight.handler("grid-layer","layer",e),e}(),niclabs.insight.layer.HeatmapLayer=function(e){var r=function(r,t){function n(t,n){var i;if("type"in n){var o={layer:a.id,data:t};e.extend(o,n),i=niclabs.insight.handler(n.type)(r,o)}else i=n;return i}var i,a=niclabs.insight.layer.Layer(r,t),o=t.heatmap||{type:"point-heatmap"};return a.draw=function(e){i=n(e,o)},a.clear=function(){i&&i.clear()},a.filter=function(e){},a};return niclabs.insight.handler("heatmap-layer","layer",r),r}(jQuery),niclabs.insight.layer.Layer=function(e){"use strict";var r=function(r,t){if(!("id"in t))throw Error("All layers must have an id.");var n=t.id,i=t.name||t.id;if(!("data"in t))throw Error("All layers must provide a data source.");var a=!1,o=[];"string"==typeof t.data?a=t.data:o=t.data&&Array.isArray(t.data)?t.data:[t.data];var s=t.summary||!1,l=!1,c={get id(){return n},get name(){return i},data:function(e){return"undefined"==typeof e?l||!a?o:a:"string"==typeof e?a=e:(o=e.length?e:[e],l&&c.load(),o)},load:function(){function r(e){if(o=e,niclabs.insight.event.trigger("layer_data",{id:n,data:o}),c.clear(),s){var r=s;"function"==typeof s&&(r=s(o)),niclabs.insight.event.trigger("layer_summary",{id:n,data:r})}c.draw(o),l=!0}a?e.getJSON(a,r):r(o)},draw:function(e){},filter:function(e){},clear:function(){}};return c};return r}(jQuery),niclabs.insight.layer.MarkerLayer=function(e){var r=function(r,t){function n(t,n,a){var o;if("type"in a){var s={layer:i.id};e.extend(s,a,t[n]),o=niclabs.insight.handler(s.type)(r,s)}else o=a;return o.clickable(!0),o}var i=niclabs.insight.layer.Layer(r,t),a=t.marker||{type:"simple-marker"},o=[];return i.draw=function(e){for(var r=0;r<e.length;r++)o.push(n(e,r,a))},i.clear=function(){for(var e=0;e<o.length;e++)o[e].clear();o=[]},i.filter=function(e){for(var r=i.data(),t=0;t<o.length;t++)o[t].visible(e(r[t]))},i};return niclabs.insight.handler("marker-layer","layer",r),r}(jQuery),niclabs.insight.map=function(){"undefined"==typeof Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180}),"undefined"==typeof Number.prototype.toDeg&&(Number.prototype.toDeg=function(){return 180*this/Math.PI});var e=function(e){var r=niclabs.insight.dashboard();if("undefined"==typeof r)throw new Error("Dashboard has not been initialized");return r.map(e)};return e}();var style=[{featureType:"administrative",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#444444"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#e9e9e9"}]},{featureType:"landscape",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{hue:"#0bff00"},{lightness:"74"}]},{featureType:"poi.park",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#77c3c6"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"on"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"road.local",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#004787"},{visibility:"on"},{lightness:"84"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]}];niclabs.insight.map.GoogleMercator=function(){function e(e,r,t){return null!==r&&(e=Math.max(e,r)),null!==t&&(e=Math.min(e,t)),e}var r=256,t={x:r/2,y:r/2},n=r/360,i=r/(2*Math.PI);return{geographic:function(e){var r=(e.x-t.x)/n,a=(e.y-t.y)/-i,o=(2*Math.atan(Math.exp(a))-Math.PI/2).toDeg();return{lat:o,lng:r}},cartesian:function(r){"function"==typeof r.lat&&"function"==typeof r.lng&&(r={lat:r.lat(),lng:r.lng()});var a=t.x+r.lng*n,o=e(Math.sin(r.lat.toRad()),-.9999,.9999),s=t.y+.5*Math.log((1+o)/(1-o))*-i;return{x:a,y:s}},distance:function(e,r){return r="undefined"!=typeof r?r:12,e/(1<<r)}}}(),niclabs.insight.map.GoogleMap=function(e){"use strict";var r=function(e,r){var t=niclabs.insight.MapView(r),n=new google.maps.Map(t.element,{zoom:t.zoom(),center:new google.maps.LatLng(t.lat,t.lng),disableDefaultUI:!0}),i=t.zoom;google.maps.event.addListener(n,"zoom_changed",function(){i(n.getZoom())}),t.zoom=function(e){return e=i(e),n.setZoom(e),e};var a=t.center;return google.maps.event.addListener(n,"center_changed",function(){var e=n.getCenter();a(e.lat(),e.lng())}),t.center=function(e,r){var t=a(e,r);return n.setCenter({lat:t.lat,lng:t.lng}),t},t.googlemap=function(){return n},t};return niclabs.insight.handler("google-map","map-view",r),r}(jQuery),niclabs.insight.quadtree={},niclabs.insight.quadtree.Bounds=function(){var e=function(e,r){var t={x:(e.x+r.x)/2,y:(e.y+r.y)/2};return{get center(){return t},get min(){return e},get max(){return r},contains:function(t){return e.x<=t.x&&t.x<r.x&&e.y<=t.y&&t.y<r.y},intersects:function(t){return r.x<t.min.x?!1:e.x>t.max.x?!1:r.y<t.min.y?!1:e.y>t.max.y?!1:!0}}};return e}(),niclabs.insight.quadtree.PointQuadTree=function(){var e=function(r,t,n){function i(){a=e(niclabs.insight.quadtree.Bounds(r.min,r.center),t,n-1),o=e(niclabs.insight.quadtree.Bounds({x:r.center.x,y:r.min.y},{x:r.max.x,y:r.center.y}),t,n-1),s=e(niclabs.insight.quadtree.Bounds({x:r.min.x,y:r.center.y},{x:r.center.x,y:r.max.y}),t,n-1),l=e(niclabs.insight.quadtree.Bounds(r.center,r.max,t,n-1))}t=t||50,n=n||40;var a,o,s,l,c=[],u={get capacity(){return t},get bounds(){return r},insert:function(e){return r.contains(e)?c.length<t||0>=n?(c.push(e),!0):(void 0===a&&i(),a.insert(e)?!0:o.insert(e)?!0:s.insert(e)?!0:l.insert(e)?!0:!1):!1},query:function(e,t){if(t="undefined"==typeof t?[]:t,!r.intersects(e))return t;for(var n=0;n<c.length;n++)e.contains(c[n])&&t.push(c[n]);return void 0===a?t:(a.query(e,t),o.query(e,t),s.query(e,t),l.query(e,t),t)}};return u};return e}(),niclabs.insight.map.diagram=function(e){return{createLines:function(e,r){var t=180/Math.PI;if(!(r.length<2)){for(var n=e[r[0]],i=[n],a=0,o=1;o<r.length;o++)a=e[r[o]],i=i.concat(this.SplitSegment(n,a),[a]),n=a;for(var s=[],l=0;l<i.length;l++){a=i[l];var c=t*Math.atan2(a[2],Math.sqrt(a[0]*a[0]+a[1]*a[1])),u=t*Math.atan2(a[1],a[0]);s.push([c,u])}return s}},SplitSegment:function(e,r){for(var t=0,n=0;3>n;n++){var i=r[n]-e[n];t+=i*i}var a=[];if(.01>t)return a;var o=new Array(3);for(n=0;3>n;n++)o[n]=e[n]+r[n];var s=0;for(n=0;3>n;n++)pc=o[n],s+=pc*pc;var l=1/Math.sqrt(s);for(n=0;3>n;n++)o[n]*=l;return a.concat(this.SplitSegment(e,o),[o],this.SplitSegment(o,r))},transformMapPositions:function(e){var r=Math.PI/180,t=[];for(i=0;i<e.length;i++){for(var n=e[i],a=r*n.lat,o=r*n.lng,s=Math.cos(a),l=[s*Math.cos(o),s*Math.sin(o),Math.sin(a)],c=0;3>c;c++)l[c]+=1e-10*(2*Math.random()-1);var u=0;for(c=0;3>c;c++)u+=l[c]*l[c];var d=1/Math.sqrt(u);for(c=0;3>c;c++)l[c]*=d;t.push(l)}return t}}}(jQuery),niclabs.insight.map.diagram.DelaunayDiagram=function(e){var r=function(e,r){function t(e){for(var t=[],n=e.length,i=[],a=0;n>a;a++)i[a]=new google.maps.LatLng(e[a].lat,e[a].lng);var o=niclabs.insight.map.diagram.transformMapPositions(e),s=FindDelaunayTriangulation(o),l=[];for(a=0;a<s.edges.length;a++){var c=s.edges[a];t=niclabs.insight.map.diagram.createLines(s.positions,c.verts);for(var u=[],d=0;d<t.length;d++)u.push(new google.maps.LatLng(t[d][0],t[d][1]));var f=new google.maps.Polyline({path:u,strokeColor:r.strokeColor||"#FF0000",strokeWeight:r.strokeWeight||2,strokeOpacity:r.strokeOpacity||1,clickable:!1});l.push(f)}for(markers=[],a=0;a<i.length;a++){var g=new google.maps.Marker({position:i[a],title:e[a].landmark||""});markers[a]=g}return{Polylines:l,Markers:markers}}if(!("data"in r))throw Error("No data provided for the diagram");var n=niclabs.insight.map.diagram.Diagram(e,r),i=t(r.data);n.setMap(i,n.map.googlemap());var a=n.clear;return n.clear=function(){a(),n.setMap(i,null)},n};return niclabs.insight.handler("delaunay-diagram","diagram",r),r}(jQuery),niclabs.insight.map.diagram.Diagram=function(e){var r=function(e,r){if(!("layer"in r))throw new Error("The Diagram must be associated to a layer");var t;if(!(t=e.layer(r.layer)))throw new Error("The layer "+t+" does not exist in the dashboard");var n;if(!(n=e.map()))throw new Error("No map has been initialized for the dashboard yet");if(!("googlemap"in n))throw new Error("Diagrams are only supported for Google Maps at the moment");var i={get map(){return n},get layer(){return t},clear:function(){},setMap:function(e,r){for(var t in e.Polylines)e.Polylines[t].setMap(r);for(var n in e.Markers)e.Markers[n].setMap(r)}};return i};return r}(jQuery),niclabs.insight.map.diagram.VoronoiDiagram=function(e){var r=function(e,r){function t(e){for(var t=[],n=e.length,i=[],a=0;n>a;a++)i[a]=new google.maps.LatLng(e[a].lat,e[a].lng);var o=niclabs.insight.map.diagram.transformMapPositions(e),s=FindDelaunayTriangulation(o),l=[];for(a=0;a<s.vor_edges.length;a++){var c=s.vor_edges[a];if(!(c[0]<0||c[1]<0)){t=niclabs.insight.map.diagram.createLines(s.vor_positions,c);for(var u=[],d=0;d<t.length;d++)u.push(new google.maps.LatLng(t[d][0],t[d][1]));var f=new google.maps.Polyline({path:u,strokeColor:r.strokeColor||"#FF0000",strokeWeight:r.strokeWeight||2,strokeOpacity:r.strokeOpacity||1,clickable:!1});l.push(f)}}for(markers=[],a=0;a<i.length;a++){var g=new google.maps.Marker({position:i[a],title:e[a].landmark||""});markers[a]=g}return{Polylines:l,Markers:markers}}if(!("data"in r))throw Error("No data provided for the diagram");var n=niclabs.insight.map.diagram.Diagram(e,r),i=t(r.data);n.setMap(i,n.map.googlemap());var a=n.clear;return n.clear=function(){a(),n.setMap(i,null)},n};return niclabs.insight.handler("voronoi-diagram","diagram",r),r}(jQuery),niclabs.insight.map.graph={},niclabs.insight.map.graph.Edge=function(e){var r=function(e,r){var t=niclabs.insight.map.graph.GraphElement(e,r),n=[];n[0]=new google.maps.LatLng(r.startNode.lat,r.startNode.lng),n[1]=new google.maps.LatLng(r.endNode.lat,r.endNode.lng);var i=new google.maps.Polyline({path:n,strokeColor:"#000000",strokeOpacity:1,strokeWeight:10});return i.setMap(t.map.googlemap()),t.graphElement=function(){return i},t.clickable=function(){var e=t.graphElement();return listener=google.maps.event.addListener(e,"click",function(){niclabs.insight.event.trigger("map_element_selected",r),"setOptions"in e&&(e.setOptions({strokeColor:"#FF0000"}),setTimeout(function(){e.setOptions({strokeColor:"#000000"})},1e3))}),listener},t};return niclabs.insight.handler("edge","graph",r),r}(jQuery),niclabs.insight.map.graph.GraphElement=function(e){var r=function(e,r){if(!("layer"in r))throw new Error("The marker must be associated to a layer");var t;if(!(t=e.layer(r.layer)))throw new Error("The layer "+t+" does not exist in the dashboard");var n;if(!(n=e.map()))throw new Error("No map has been initialized for the dashboard yet");if(!("googlemap"in n))throw new Error("Markers are only supported for Google Maps at the moment");var i={get map(){return n},get layer(){return t},graphElement:function(){return void 0},clickable:function(e){},clear:function(){var e=i.graphElement();e.setMap(null)},visible:function(e){return"undefined"==typeof e?i.graphElement().getVisible():(i.graphElement().setVisible(e),e)}};return i};return r}(jQuery),niclabs.insight.map.graph.Node=function(e){var r=function(e,r){var t=niclabs.insight.map.graph.GraphElement(e,r),n=new google.maps.LatLng(parseFloat(r.lat),parseFloat(r.lng)),i=new google.maps.Marker({position:n,map:t.map.googlemap(),title:r.landmark||""});return t.graphElement=function(){return i},t.clickable=function(){var e=t.graphElement();return listener=google.maps.event.addListener(e,"click",function(){niclabs.insight.event.trigger("map_element_selected",r),"setAnimation"in e&&(e.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.setAnimation(null)},1e3))}),listener},t};return niclabs.insight.handler("node","graph",r),r}(jQuery),niclabs.insight.map.grid={},niclabs.insight.map.grid.Grid=function(){function e(e,r){return e=niclabs.insight.Color.hexToRgb(e),r=niclabs.insight.Color.hexToRgb(r),function(t){var n=0,a=0;for(i=0;i<t.length;i++)"weight"in t[i]&&(n+=t[i].weight,a++);return a>0?(n/=a,niclabs.insight.Color.rgbToHex(niclabs.insight.Interpolation.interpolateRgb(n,1,e,r))):"#ffffff"}}function r(e){return function(r){var t=0;for(hist={},i=0;i<r.length;i++)"weight"in r[i]&&"category"in r[i]&&(r[i].category in hist?hist[r[i].category]+=r[i].weight:hist[r[i].category]=r[i].weight,t++);var n=[];for(var a in hist)n.push([a,hist[a]]);return n.sort(function(e,r){return r[1]-e[1]}),t>0?e[n[0][0]]:"#ffffff"}}function t(e,r){function t(e,r,t){for(var n,i=Math.floor((r+t)/2);t>=r;){for(;e[r].weight<e[i].weight;)r++;for(;e[t].weight>e[i].weight;)t--;t>=r&&(n=e[r],e[r]=e[t],e[t]=n,r++,t--)}return i}return e=niclabs.insight.Color.hexToRgb(e),r=niclabs.insight.Color.hexToRgb(r),function(n){var i=0,a=0,o=n.length>0?n.length-1:0,s=Math.floor((a+o)/2);for(i=t(n,a,o);i!==s;)i=s>i?t(n,s,o):t(n,a,s);return niclabs.insight.Color.rgbToHex(niclabs.insight.Interpolation.interpolateRgb(n[i].weight,1,e,r))}}var n=function(n,i){function a(){return"#ffffff"}function o(e){return function(){niclabs.insight.event.trigger("map_element_selected",e)}}function s(){for(var e=0;e<f.length;e++)f[e].setMap(null)}function l(e){e="undefined"!=typeof e?e:d.googlemap().getBounds(),s(),c(e),b.toggle(!0)}function c(e){if(e){for(var r,t,n=w.tile(),i=v.query(niclabs.insight.quadtree.Bounds(niclabs.insight.map.GoogleMercator.cartesian({lat:e.getNorthEast().lat(),lng:e.getSouthWest().lng()}),niclabs.insight.map.GoogleMercator.cartesian({lat:e.getSouthWest().lat(),lng:e.getNorthEast().lng()}))),a=[],s=0;s<i.length;s++){var l=n.query(i[s]);r=l[0],t=l[1],a[r]||(a[r]=[]),a[r][t]||(a[r][t]=[]),a[r][t].push(i[s])}f=[];for(r in a)for(t in a[r]){g.fillColor=h(a[r][t]);var c=n.draw(n.origin(r,t),w.map,g);google.maps.event.addListener(c,"click",o(a[r][t])),f.push(c)}}}if(!("layer"in i))throw new Error("The grid must be associated to a layer");var u;if(!(u=n.layer(i.layer)))throw new Error("The layer "+u+" does not exist in the dashboard");var d;if(!(d=n.map()))throw new Error("No map has been initialized for the dashboard yet");if(!("googlemap"in d))throw new Error("Grids are only supported for Google Maps at the moment");var f=[],g={strokeColor:"strokeColor"in i?i.strokeColor:"#000000",strokeOpacity:"strokeOpacity"in i?i.strokeOpacity:.6,strokeWeight:"strokeWeight"in i?i.strokeWeight:2,fillOpacity:"fillOpacity"in i?i.fillOpacity:.6},h=i.fill||a;"string"==typeof h&&(h="#"===i.fill.charAt(0)?function(){return i.fill}:"average"===i.fill?e(i.fillStart||"#ff0000",i.fillEnd||"#00ff00"):"median"===i.fill?t(i.fillStart||"#ff0000",i.fillEnd||"#00ff00"):"category"===i.fill?r(i.colorMap):a);for(var p=niclabs.insight.quadtree.Bounds(niclabs.insight.map.GoogleMercator.cartesian({lat:90,lng:-180}),niclabs.insight.map.GoogleMercator.cartesian({lat:-90,lng:180})),v=niclabs.insight.quadtree.PointQuadTree(p),y=0;y<i.data.length;y++){var m=niclabs.insight.map.GoogleMercator.cartesian(i.data[y]);i.data[y].x=m.x,i.data[y].y=m.y,v.insert(i.data[y])}var b=function(){var e;return{toggle:function(r){r&&"undefined"==typeof e?e=google.maps.event.addListener(w.map.googlemap(),"bounds_changed",function(){l(this.getBounds())}):r||"undefined"==typeof e||(google.maps.event.removeListener(e),e=void 0)}}}(),w={get map(){return d},get layer(){return u},refresh:l,tile:function(){throw new Error("Not implemented")},clear:function(){s(),b.toggle(!1)}};return w};return n}(),niclabs.insight.map.grid.HexagonTile=function(){var e=function(e){var r=Math.cos(Math.PI/6)*e,t=Math.sin(Math.PI/6)*e,n=niclabs.insight.map.grid.Tile();return Object.defineProperty(n,"s",{get:function(){return e}}),Object.defineProperty(n,"r",{get:function(){return r}}),Object.defineProperty(n,"h",{get:function(){return t}}),n.origin=function(){var n,i;1==arguments.length?(n=arguments[0][0],i=arguments[0][1]):(n=arguments[0],i=arguments[1]);var a=2*n*r+(1&i)*r+r,o=i*(t+e);return{x:a,y:o}},n.query=function(n){n.lat&&(n=niclabs.insight.map.GoogleMercator.cartesian(n));var i=Math.floor(n.x/(2*r)),a=Math.floor(n.y/(t+e)),o=n.x-2*i*r,s=n.y-a*(t+e),l=0===(1&a),c=i,u=a;return l?r>=o&&-t/r*o+t>s?(c=i-1,u=a-1):o>r&&t/r*o-t>s&&(c=i,u=a-1):r>=o?t/r*o>s?(c=i,u=a-1):(c=i-1,u=a):o>r&&-t/r*o+2*t>s&&(c=i,u=a-1),[c,u]},n.vertices=function(n){n.lat&&(n=niclabs.insight.map.GoogleMercator.cartesian(n));var i=[];return i[0]={x:n.x,y:n.y},i[1]={x:n.x+r,y:n.y+t},i[2]={x:n.x+r,y:n.y+e+t},i[3]={x:n.x,y:n.y+e+t+t},i[4]={x:n.x-r,y:n.y+e+t},i[5]={x:n.x-r,y:n.y+t},i},n};return e}(),niclabs.insight.map.grid.HexagonalGrid=function(){var e=function(e,r){var t=niclabs.insight.map.grid.Grid(e,r);return t.tile=function(){return niclabs.insight.map.grid.HexagonTile(niclabs.insight.map.GoogleMercator.distance(r.size,t.map.zoom()))},t.refresh(),t};return niclabs.insight.handler("hexagon","grid",e),e}(),niclabs.insight.map.grid.SquareGrid=function(){var e=function(e,r){var t=niclabs.insight.map.grid.Grid(e,r);return t.tile=function(){return niclabs.insight.map.grid.SquareTile(niclabs.insight.map.GoogleMercator.distance(r.size,t.map.zoom()))},t.refresh(),t};return niclabs.insight.handler("square","grid",e),e}(),niclabs.insight.map.grid.SquareTile=function(){var e=function(e){var r=niclabs.insight.map.grid.Tile();return Object.defineProperty(r,"s",{get:function(){return e}}),r.origin=function(){var r,t;1==arguments.length?(r=arguments[0][0],t=arguments[0][1]):(r=arguments[0],t=arguments[1]);var n=r*e,i=t*e;return{x:n,y:i}},r.query=function(r){r.lat&&(r=niclabs.insight.map.GoogleMercator.cartesian(r));var t=Math.floor(r.x/e),n=Math.floor(r.y/e);return[t,n]},r.vertices=function(r){r.lat&&(r=niclabs.insight.map.GoogleMercator.cartesian(r));var t=[];return t[0]={x:r.x,y:r.y},t[1]={x:r.x,y:r.y+e},t[2]={x:r.x+e,y:r.y+e},t[3]={x:r.x+e,y:r.y},t},r};return e}(),niclabs.insight.map.grid.Tile=function(){var e=function(){var e={origin:function(e,r){throw new Error("Not implemented")},query:function(e){throw new Error("Not implemented")},vertices:function(e){throw new Error("Not implemented")},draw:function(r,t,n){if(!("googlemap"in t))throw new Error("Sorry, I only know how to draw on Google Maps at the moment");for(var i=e.vertices(r),a=[],o=0;o<i.length;o++)a.push(niclabs.insight.map.GoogleMercator.geographic(i[o]));n=n||{strokeColor:"#000000",strokeOpacity:.6,strokeWeight:2,fillColor:"#ffffff",fillOpacity:.6},n.paths=a,n.geodesic=!0;var s=new google.maps.Polygon(n);return s.setMap(t.googlemap()),s}};return e};return e}(),niclabs.insight.map.heatmap={},niclabs.insight.map.heatmap.Heatmap=function(e){var r=function(e,r){if(!("layer"in r))throw new Error("The heatmap must be associated to a layer");var t;if(!(t=e.layer(r.layer)))throw new Error("The layer "+t+" does not exist in the dashboard");var n;if(!(n=e.map()))throw new Error("No map has been initialized for the dashboard yet");if(!("googlemap"in n))throw new Error("Heatmaps are only supported for Google Maps at the moment");var i={get map(){return n},get layer(){return t},clear:function(){}};return i};return r}(jQuery),niclabs.insight.map.heatmap.PointHeatmap=function(e){var r=function(e,r){function t(e){for(var t=new google.maps.MVCArray,n=0;n<e.length;n++)"weight"in e[n]?t.push({location:new google.maps.LatLng(e[n].lat,e[n].lng),weight:e[n].weight}):t.push(new google.maps.LatLng(e[n].lat,e[n].lng));return new google.maps.visualization.HeatmapLayer({data:t,radius:r.radius||10})}if(!("data"in r))throw Error("No data provided for the heatmap");var n=niclabs.insight.map.heatmap.Heatmap(e,r),i=t(r.data);"undefined"!=typeof r.dissipating&&i.set("dissipating",r.dissipating),"undefined"!=typeof r.gradient&&i.set("gradient",r.gradient),"undefined"!=typeof r.opacity&&i.set("opacity",r.opacity),i.setMap(n.map.googlemap());var a=n.clear;return n.clear=function(){a(),i.setMap(null)},n};return niclabs.insight.handler("point-heatmap","heatmap",r),r}(jQuery),niclabs.insight.map.heatmap.SegmentHeatmap=function(e){var r=function(e,r){function t(e){var t=new google.maps.MVCArray;for(i=0;i<e.length;i++){segment_size=e[i].coordinates.length;for(var n=0;n<segment_size-1;n++)for(var a=Math.sqrt(Math.pow(e[i].coordinates[n+1][0]-e[i].coordinates[n][0],2)+Math.pow(e[i].coordinates[n+1][1]-e[i].coordinates[n][1],2)),o=Math.floor(a/1e-5),s={lat:(e[i].coordinates[n+1][0]-e[i].coordinates[n][0])/o,lng:(e[i].coordinates[n+1][1]-e[i].coordinates[n][1])/o},l=0;o>l;l++)"weight"in e[i]?t.push({location:new google.maps.LatLng(e[i].coordinates[n][0]+s.lat*l,e[i].coordinates[n][1]+s.lng*l),weight:e[i].weight}):t.push(new google.maps.LatLng(e[i].coordinates[n][0]+s.lat*l,e[i].coordinates[n][1]+s.lng*l))}return new google.maps.visualization.HeatmapLayer({data:t,radius:r.radius||10})}if(!("data"in r))throw Error("No data provided for the heatmap");var n=niclabs.insight.map.heatmap.Heatmap(e,r),a=t(r.data);"undefined"!=typeof r.dissipating&&a.set("dissipating",r.dissipating),"undefined"!=typeof r.gradient&&a.set("gradient",r.gradient),"undefined"!=typeof r.opacity&&a.set("opacity",r.opacity),a.setMap(n.map.googlemap());var o=n.clear;return n.clear=function(){o(),a.setMap(null)},n};return niclabs.insight.handler("segment-heatmap","heatmap",r),r}(jQuery),niclabs.insight.map.marker={},niclabs.insight.map.marker.CircleMarker=function(e){var r=function(e,r){var t=niclabs.insight.map.marker.Marker(e,r),n=new google.maps.LatLng(parseFloat(r.lat),parseFloat(r.lng)),i=new google.maps.Circle({center:n,map:t.map.googlemap(),radius:r.radius||400,strokeColor:r.strokeColor||"#FF0000",strokeOpacity:r.strokeOpacity||.8,strokeWeight:r.strokeWeight||2,fillColor:r.fillColor||"#FF0000",fillOpacity:r.fillOpacity||.35,title:r.landmark||""});return t.marker=function(){return i},t};return niclabs.insight.handler("circle-marker","marker",r),r}(jQuery),niclabs.insight.map.marker.ImageMarker=function(e){var r=function(e,r){var t=niclabs.insight.map.marker.Marker(e,r),n=new google.maps.LatLng(parseFloat(r.lat),parseFloat(r.lng));if(!("src"in r))throw new Error("An image source must be provided for using image markers");var i={url:r.src,scaledSize:new google.maps.Size(30,50)},a=new google.maps.Marker({position:n,map:t.map.googlemap(),icon:i,title:r.landmark||""});return t.marker=function(){return a},t};return niclabs.insight.handler("image-marker","marker",r),r}(jQuery),niclabs.insight.map.marker.Marker=function(e){var r=function(e,r){if(!("layer"in r))throw new Error("The marker must be associated to a layer");var t;if(!(t=e.layer(r.layer)))throw new Error("The layer "+t+" does not exist in the dashboard");var n;if(!(n=e.map()))throw new Error("No map has been initialized for the dashboard yet");if(!("googlemap"in n))throw new Error("Markers are only supported for Google Maps at the moment");var i,a={get map(){return n},get layer(){return t},marker:function(){return void 0},clickable:function(e){if(e){var t=a.marker();i=google.maps.event.addListener(t,"click",function(){niclabs.insight.event.trigger("map_element_selected",r),"setAnimation"in t&&(t.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){t.setAnimation(null)},3e3))})}else"undefined"!=typeof i&&(google.maps.event.removeListener(i),i=void 0);return void 0!==i},clear:function(){var e=a.marker();e.setMap(null)},visible:function(e){return"undefined"==typeof e?a.marker().getVisible():(a.marker().setVisible(e),e)}};return a};return r}(jQuery),niclabs.insight.map.marker.SimpleMarker=function(e){var r=function(e,r){var t=niclabs.insight.map.marker.Marker(e,r),n=new google.maps.LatLng(parseFloat(r.lat),parseFloat(r.lng)),i=new google.maps.Marker({position:n,map:t.map.googlemap(),title:r.landmark||""});return t.marker=function(){return i},t};return niclabs.insight.handler("simple-marker","marker",r),r}(jQuery),TriangleObject.prototype.copy_vert_info=function(e){this.verts=e.verts,this.dirs=e.dirs,this.vol=e.vol,this.ccdir=e.ccdir,this.ccdsq=e.ccdsq},TriangleObject.prototype.IsVertexOrderCorrect=function(){return this.vol>=0},TriangleObject.prototype.IsPointInside=function(e){for(var r=0;3>r;r++)if(dotprd(e,this.dirs[r])<0)return!1;return!0},TriangleObject.prototype.IsPointInCircumcircle=function(e){return ptdist(this.ccdir,e)<this.ccdsq},TriangleObject.prototype.IsVertex=function(e){for(var r=0;3>r;r++)if(e==this.verts[r])return!0;return!1},TriangleObject.prototype.VertexIndexIn=function(e){for(var r=0;3>r;r++)if(e==this.verts[r])return r;return-1},TriangleObject.prototype.EdgeIndexIn=function(e){for(var r=0;3>r;r++)if(EdgesEqual(this.edges[r],e))return r;return-1},EdgeObject.prototype.IsVertex=function(e){for(var r=0;2>r;r++)if(e==this.verts[r])return!0;return!1},EdgeObject.prototype.VertexIndexIn=function(e){for(var r=0;2>r;r++)if(e==this.verts[r])return r;return-1},EdgeObject.prototype.PolyIndexIn=function(e){for(var r=0;2>r;r++)if(TrianglesEqual(this.polys[r],e))return r;return-1},EdgeCheckObject.prototype.intersects=function(e,r){for(var t=0;2>t;t++)for(var n=0;2>n;n++)if(this.verts[t]==r.verts[n])return!1;var i=Normalize(crsprd(this.direc,r.direc)),a=dotprd(i,this.midpnt)>0,o=dotprd(i,r.midpnt)>0;if(o!=a)return!1;var s,l=[];for(t=0;2>t;t++)s=ptdist(i,e[this.verts[t]]),l.push(s);var c=[];for(t=0;2>t;t++)s=ptdist(i,e[r.verts[t]]),c.push(s);var u=max(l[0],l[1]),d=max(c[0],c[1]);if(u<=this.pdst&&d<=r.pdst&&a)return!0;for(vec_mult_scalar_to(i,-1),a=!a,t=0;2>t;t++)l[t]=-l[t],c[t]=-c[t];return u=max(l[0],l[1]),d=max(c[0],c[1]),u<=this.pdst&&d<=r.pdst&&a?!0:!1};